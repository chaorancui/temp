[toc]

# Docker å­¦ä¹ 

> [ä»€ä¹ˆæ˜¯ Dockerï¼Ÿçœ‹è¿™ä¸€ç¯‡å¹²è´§æ–‡ç« å°±å¤Ÿäº†ï¼](https://zhuanlan.zhihu.com/p/187505981)

**ç›®çš„**

ä¸ºè§£å†³é‡å¤æ­å»ºå¼€å‘/æµ‹è¯•ç¯å¢ƒçš„é—®é¢˜ï¼Œåº”è¿è€Œç”Ÿçš„æŠ€æœ¯ã€‚

**å®¹å™¨æŠ€æœ¯ vs è™šæ‹Ÿæœº**

è™šæ‹Ÿæœº clone ä¹Ÿå¯ä»¥è§£å†³é—®é¢˜ï¼Œä½†è™šæ‹Ÿæœºéœ€è¦åŒæ­¥ clone æ“ä½œç³»ç»Ÿï¼Œå†…å­˜æµªè´¹ä¸”å¯åŠ¨æ…¢ã€‚å¯¹äº**ä»…éƒ¨ç½²åº”ç”¨ç¨‹åº**è¯‰æ±‚æ¥è¯´ï¼Œä¸æ˜¯æœ€ä¼˜è§£ã€‚

**ä»€ä¹ˆæ˜¯å®¹å™¨**

å®¹å™¨ä¸€è¯çš„è‹±æ–‡æ˜¯ containerï¼Œå…¶å® container è¿˜æœ‰é›†è£…ç®±çš„æ„æ€ï¼Œé›†è£…ç®±ç»å¯¹æ˜¯å•†ä¸šå²ä¸Šäº†ä¸èµ·çš„ä¸€é¡¹å‘æ˜ï¼Œå¤§å¤§é™ä½äº†æµ·æ´‹è´¸æ˜“è¿è¾“æˆæœ¬ã€‚è®©æˆ‘ä»¬æ¥çœ‹çœ‹é›†è£…ç®±çš„å¥½å¤„ï¼š

- é›†è£…ç®±ä¹‹é—´ç›¸äº’éš”ç¦»
- é•¿æœŸåå¤ä½¿ç”¨
- å¿«é€Ÿè£…è½½å’Œå¸è½½
- è§„æ ¼æ ‡å‡†ï¼Œåœ¨æ¸¯å£å’Œèˆ¹ä¸Šéƒ½å¯ä»¥æ‘†æ”¾

å›åˆ°è½¯ä»¶ä¸­çš„å®¹å™¨ï¼Œå…¶å®å®¹å™¨å’Œé›†è£…ç®±åœ¨æ¦‚å¿µä¸Šæ˜¯å¾ˆç›¸ä¼¼çš„ã€‚

ä¸è™šæ‹Ÿæœºé€šè¿‡æ“ä½œç³»ç»Ÿå®ç°éš”ç¦»ä¸åŒï¼Œå®¹å™¨æŠ€æœ¯**åªéš”ç¦»åº”ç”¨ç¨‹åºçš„è¿è¡Œæ—¶ç¯å¢ƒä½†å®¹å™¨ä¹‹é—´å¯ä»¥å…±äº«åŒä¸€ä¸ªæ“ä½œç³»ç»Ÿ**ï¼Œè¿™é‡Œçš„è¿è¡Œæ—¶ç¯å¢ƒæŒ‡çš„æ˜¯ç¨‹åºè¿è¡Œä¾èµ–çš„å„ç§åº“ä»¥åŠé…ç½®ã€‚

å®¹å™¨æ›´åŠ çš„**è½»é‡çº§ä¸”å ç”¨çš„èµ„æºæ›´å°‘**ï¼Œä¸æ“ä½œç³»ç»ŸåŠ¨è¾„å‡  G çš„å†…å­˜å ç”¨ç›¸æ¯”ï¼Œå®¹å™¨æŠ€æœ¯åªéœ€æ•° M ç©ºé—´ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥åœ¨åŒæ ·è§„æ ¼çš„ç¡¬ä»¶ä¸Š**å¤§é‡éƒ¨ç½²å®¹å™¨**ï¼Œè¿™æ˜¯è™šæ‹Ÿæœºæ‰€ä¸èƒ½æ¯”æ‹Ÿçš„ï¼Œè€Œä¸”ä¸åŒäºæ“ä½œç³»ç»Ÿæ•°åˆ†é’Ÿçš„å¯åŠ¨æ—¶é—´å®¹å™¨å‡ ä¹ç¬æ—¶å¯åŠ¨ï¼Œå®¹å™¨æŠ€æœ¯ä¸º**æ‰“åŒ…æœåŠ¡æ ˆ**æä¾›äº†ä¸€ç§æ›´åŠ é«˜æ•ˆçš„æ–¹å¼ï¼ŒSo coolã€‚

é‚£ä¹ˆæˆ‘ä»¬è¯¥æ€ä¹ˆä½¿ç”¨å®¹å™¨å‘¢ï¼Ÿè¿™å°±è¦è®²åˆ° docker äº†ã€‚

==æ³¨æ„ï¼Œ**å®¹å™¨æ˜¯ä¸€ç§é€šç”¨æŠ€æœ¯ï¼Œdocker åªæ˜¯å…¶ä¸­çš„ä¸€ç§å®ç°**ã€‚==

**ä»€ä¹ˆæ˜¯ docker**

docker æ˜¯ä¸€ä¸ªç”¨ Go è¯­è¨€å®ç°çš„å¼€æºé¡¹ç›®ï¼Œå¯ä»¥è®©æˆ‘ä»¬æ–¹ä¾¿çš„åˆ›å»ºå’Œä½¿ç”¨å®¹å™¨ï¼Œdocker å°†ç¨‹åºä»¥åŠç¨‹åºæ‰€æœ‰çš„ä¾èµ–éƒ½æ‰“åŒ…åˆ° docker containerï¼Œè¿™æ ·ä½ çš„ç¨‹åºå¯ä»¥åœ¨ä»»ä½•ç¯å¢ƒéƒ½ä¼šæœ‰ä¸€è‡´çš„è¡¨ç°ï¼Œè¿™é‡Œç¨‹åºè¿è¡Œçš„ä¾èµ–ä¹Ÿå°±æ˜¯å®¹å™¨å°±å¥½æ¯”é›†è£…ç®±ï¼Œå®¹å™¨æ‰€å¤„çš„æ“ä½œç³»ç»Ÿç¯å¢ƒå°±å¥½æ¯”è´§èˆ¹æˆ–æ¸¯å£ï¼Œ**ç¨‹åºçš„è¡¨ç°åªå’Œé›†è£…ç®±æœ‰å…³ç³»(å®¹å™¨)ï¼Œå’Œé›†è£…ç®±æ”¾åœ¨å“ªä¸ªè´§èˆ¹æˆ–è€…å“ªä¸ªæ¸¯å£(æ“ä½œç³»ç»Ÿ)æ²¡æœ‰å…³ç³»**ã€‚

å› æ­¤æˆ‘ä»¬å¯ä»¥çœ‹åˆ° docker å¯ä»¥å±è”½ç¯å¢ƒå·®å¼‚ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œåªè¦ä½ çš„ç¨‹åºæ‰“åŒ…åˆ°äº† docker ä¸­ï¼Œé‚£ä¹ˆæ— è®ºè¿è¡Œåœ¨ä»€ä¹ˆç¯å¢ƒä¸‹ç¨‹åºçš„è¡Œä¸ºéƒ½æ˜¯ä¸€è‡´çš„ï¼Œç¨‹åºå‘˜å†ä¹Ÿæ— æ³•æ–½å±•è¡¨æ¼”æ‰åäº†ï¼Œ**ä¸ä¼šå†æœ‰â€œåœ¨æˆ‘çš„ç¯å¢ƒä¸Šå¯ä»¥è¿è¡Œâ€**ï¼ŒçœŸæ­£å®ç°â€œbuild once, run everywhereâ€ã€‚

æ­¤å¤– docker çš„å¦ä¸€ä¸ªå¥½å¤„å°±æ˜¯**å¿«é€Ÿéƒ¨ç½²**ï¼Œè¿™æ˜¯å½“å‰äº’è”ç½‘å…¬å¸æœ€å¸¸è§çš„ä¸€ä¸ªåº”ç”¨åœºæ™¯ï¼Œä¸€ä¸ªåŸå› åœ¨äºå®¹å™¨å¯åŠ¨é€Ÿåº¦éå¸¸å¿«ï¼Œå¦ä¸€ä¸ªåŸå› åœ¨äºåªè¦ç¡®ä¿ä¸€ä¸ªå®¹å™¨ä¸­çš„ç¨‹åºæ­£ç¡®è¿è¡Œï¼Œé‚£ä¹ˆä½ å°±èƒ½ç¡®ä¿¡æ— è®ºåœ¨ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²å¤šå°‘éƒ½èƒ½æ­£ç¡®è¿è¡Œã€‚

**å¦‚ä½•ä½¿ç”¨ docker**

docker ä¸­æœ‰è¿™æ ·å‡ ä¸ªæ¦‚å¿µï¼š

- dockerfile
- image
- container

å®é™…ä¸Šä½ å¯ä»¥ç®€å•çš„æŠŠ image ç†è§£ä¸ºå¯æ‰§è¡Œç¨‹åºï¼Œcontainer å°±æ˜¯è¿è¡Œèµ·æ¥çš„è¿›ç¨‹ã€‚

é‚£ä¹ˆå†™ç¨‹åºéœ€è¦æºä»£ç ï¼Œé‚£ä¹ˆâ€œå†™â€image å°±éœ€è¦ dockerfileï¼Œdockerfile å°±æ˜¯ image çš„æºä»£ç ï¼Œdocker å°±æ˜¯"ç¼–è¯‘å™¨"ã€‚

å› æ­¤æˆ‘ä»¬åªéœ€è¦åœ¨ dockerfile ä¸­æŒ‡å®šéœ€è¦å“ªäº›ç¨‹åºã€ä¾èµ–ä»€ä¹ˆæ ·çš„é…ç½®ï¼Œä¹‹åæŠŠ dockerfile äº¤ç»™â€œç¼–è¯‘å™¨â€docker è¿›è¡Œâ€œç¼–è¯‘â€ï¼Œä¹Ÿå°±æ˜¯ docker build å‘½ä»¤ï¼Œç”Ÿæˆçš„å¯æ‰§è¡Œç¨‹åºå°±æ˜¯ imageï¼Œä¹‹åå°±å¯ä»¥è¿è¡Œè¿™ä¸ª image äº†ï¼Œè¿™å°±æ˜¯ docker run å‘½ä»¤ï¼Œimage è¿è¡Œèµ·æ¥åå°±æ˜¯ docker containerã€‚

å…·ä½“çš„ä½¿ç”¨æ–¹æ³•å°±ä¸å†è¿™é‡Œèµ˜è¿°äº†ï¼Œå¤§å®¶å¯ä»¥å‚è€ƒ docker çš„å®˜æ–¹æ–‡æ¡£ï¼Œé‚£é‡Œæœ‰è¯¦ç»†çš„è®²è§£ã€‚

**docker æ˜¯å¦‚ä½•å·¥ä½œçš„**

å®é™…ä¸Š docker ä½¿ç”¨äº†å¸¸è§çš„ CS æ¶æ„ï¼Œä¹Ÿå°±æ˜¯ client-server æ¨¡å¼ï¼Œdocker client è´Ÿè´£å¤„ç†ç”¨æˆ·è¾“å…¥çš„å„ç§å‘½ä»¤ï¼Œæ¯”å¦‚`docker build`ã€`docker run`ï¼ŒçœŸæ­£å·¥ä½œçš„å…¶å®æ˜¯ serverï¼Œä¹Ÿå°±æ˜¯ docker daemonï¼Œå€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œdocker client å’Œ docker daemon å¯ä»¥è¿è¡Œåœ¨åŒä¸€å°æœºå™¨ä¸Šã€‚

æ¥ä¸‹æ¥æˆ‘ä»¬ç”¨å‡ ä¸ªå‘½ä»¤æ¥è®²è§£ä¸€ä¸‹ docker çš„å·¥ä½œæµç¨‹ï¼š

**1ï¼Œdocker build**

å½“æˆ‘ä»¬å†™å®Œ dockerfile äº¤ç»™ dockerâ€œç¼–è¯‘â€æ—¶ä½¿ç”¨è¿™ä¸ªå‘½ä»¤ï¼Œé‚£ä¹ˆ client åœ¨æ¥æ”¶åˆ°è¯·æ±‚åè½¬å‘ç»™ docker daemonï¼Œæ¥ç€ docker daemon æ ¹æ® dockerfile åˆ›å»ºå‡ºâ€œå¯æ‰§è¡Œç¨‹åºâ€imageã€‚

![img](https://pic3.zhimg.com/80/v2-f16577a98471b4c4b5b1af1036882caa_720w.webp)

**2ï¼Œdocker run**

æœ‰äº†â€œå¯æ‰§è¡Œç¨‹åºâ€image åå°±å¯ä»¥è¿è¡Œç¨‹åºäº†ï¼Œæ¥ä¸‹æ¥ä½¿ç”¨å‘½ä»¤ docker runï¼Œdocker daemon æ¥æ”¶åˆ°è¯¥å‘½ä»¤åæ‰¾åˆ°å…·ä½“çš„ imageï¼Œç„¶ååŠ è½½åˆ°å†…å­˜å¼€å§‹æ‰§è¡Œï¼Œimage æ‰§è¡Œèµ·æ¥å°±æ˜¯æ‰€è°“çš„ containerã€‚

![img](https://pic4.zhimg.com/80/v2-672b29e2d53d2ab044269b026c6bc473_720w.webp)

**3ï¼Œdocker pull**

å…¶å® docker build å’Œ docker run æ˜¯ä¸¤ä¸ªæœ€æ ¸å¿ƒçš„å‘½ä»¤ï¼Œä¼šç”¨è¿™ä¸¤ä¸ªå‘½ä»¤åŸºæœ¬ä¸Š docker å°±å¯ä»¥ç”¨èµ·æ¥äº†ï¼Œå‰©ä¸‹çš„å°±æ˜¯ä¸€äº›è¡¥å……ã€‚

é‚£ä¹ˆ docker pull æ˜¯ä»€ä¹ˆæ„æ€å‘¢ï¼Ÿ

æˆ‘ä»¬ä¹‹å‰è¯´è¿‡ï¼Œdocker ä¸­ image çš„æ¦‚å¿µå°±ç±»ä¼¼äºâ€œå¯æ‰§è¡Œç¨‹åºâ€ï¼Œæˆ‘ä»¬å¯ä»¥ä»å“ªé‡Œä¸‹è½½åˆ°åˆ«äººå†™å¥½çš„åº”ç”¨ç¨‹åºå‘¢ï¼Ÿå¾ˆç®€å•ï¼Œé‚£å°±æ˜¯ APP Storeï¼Œå³åº”ç”¨å•†åº—ã€‚ä¸ä¹‹ç±»ä¼¼ï¼Œæ—¢ç„¶ image ä¹Ÿæ˜¯ä¸€ç§â€œå¯æ‰§è¡Œç¨‹åºâ€ï¼Œé‚£ä¹ˆæœ‰æ²¡æœ‰"Docker Image Store"å‘¢ï¼Ÿç­”æ¡ˆæ˜¯è‚¯å®šçš„ï¼Œè¿™å°±æ˜¯ Docker Hubï¼Œdocker å®˜æ–¹çš„â€œåº”ç”¨å•†åº—â€ï¼Œä½ å¯ä»¥åœ¨è¿™é‡Œä¸‹è½½åˆ°åˆ«äººç¼–å†™å¥½çš„ imageï¼Œè¿™æ ·ä½ å°±ä¸ç”¨è‡ªå·±ç¼–å†™ dockerfile äº†ã€‚

docker registry å¯ä»¥ç”¨æ¥å­˜æ”¾å„ç§ imageï¼Œå…¬å…±çš„å¯ä»¥ä¾›ä»»ä½•äººä¸‹è½½ image çš„ä»“åº“å°±æ˜¯ docker Hubã€‚é‚£ä¹ˆè¯¥æ€ä¹ˆä» Docker Hub ä¸­ä¸‹è½½ image å‘¢ï¼Œå°±æ˜¯è¿™é‡Œçš„ docker pull å‘½ä»¤äº†ã€‚

å› æ­¤ï¼Œè¿™ä¸ªå‘½ä»¤çš„å®ç°ä¹Ÿå¾ˆç®€å•ï¼Œé‚£å°±æ˜¯ç”¨æˆ·é€šè¿‡ docker client å‘é€å‘½ä»¤ï¼Œdocker daemon æ¥æ”¶åˆ°å‘½ä»¤åå‘ docker registry å‘é€ image ä¸‹è½½è¯·æ±‚ï¼Œä¸‹è½½åå­˜æ”¾åœ¨æœ¬åœ°ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨ image äº†ã€‚

**docker çš„åº•å±‚å®ç°**

docker åŸºäº Linux å†…æ ¸æä¾›è¿™æ ·å‡ é¡¹åŠŸèƒ½å®ç°çš„ï¼š

- **NameSpace**
  æˆ‘ä»¬çŸ¥é“ Linux ä¸­çš„ PIDã€IPCã€ç½‘ç»œç­‰èµ„æºæ˜¯å…¨å±€çš„ï¼Œè€Œ NameSpace æœºåˆ¶æ˜¯ä¸€ç§èµ„æºéš”ç¦»æ–¹æ¡ˆï¼Œåœ¨è¯¥æœºåˆ¶ä¸‹è¿™äº›èµ„æºå°±ä¸å†æ˜¯å…¨å±€çš„äº†ï¼Œè€Œæ˜¯å±äºæŸä¸ªç‰¹å®šçš„ NameSpaceï¼Œå„ä¸ª NameSpace ä¸‹çš„èµ„æºäº’ä¸å¹²æ‰°ï¼Œè¿™å°±ä½¿å¾—æ¯ä¸ª NameSpace çœ‹ä¸Šå»å°±åƒä¸€ä¸ªç‹¬ç«‹çš„æ“ä½œç³»ç»Ÿä¸€æ ·ï¼Œä½†æ˜¯åªæœ‰ NameSpace æ˜¯ä¸å¤Ÿã€‚
- **Control groups**
  è™½ç„¶æœ‰äº† NameSpace æŠ€æœ¯å¯ä»¥å®ç°èµ„æºéš”ç¦»ï¼Œä½†è¿›ç¨‹è¿˜æ˜¯å¯ä»¥ä¸å—æ§çš„è®¿é—®ç³»ç»Ÿèµ„æºï¼Œæ¯”å¦‚ CPUã€å†…å­˜ã€ç£ç›˜ã€ç½‘ç»œç­‰ï¼Œä¸ºäº†æ§åˆ¶å®¹å™¨ä¸­è¿›ç¨‹å¯¹èµ„æºçš„è®¿é—®ï¼ŒDocker é‡‡ç”¨ control groups æŠ€æœ¯(ä¹Ÿå°±æ˜¯ cgroup)ï¼Œæœ‰äº† cgroup å°±å¯ä»¥æ§åˆ¶å®¹å™¨ä¸­è¿›ç¨‹å¯¹ç³»ç»Ÿèµ„æºçš„æ¶ˆè€—äº†ï¼Œæ¯”å¦‚ä½ å¯ä»¥é™åˆ¶æŸä¸ªå®¹å™¨ä½¿ç”¨å†…å­˜çš„ä¸Šé™ã€å¯ä»¥åœ¨å“ªäº› CPU ä¸Šè¿è¡Œç­‰ç­‰ã€‚

æœ‰äº†è¿™ä¸¤é¡¹æŠ€æœ¯ï¼Œå®¹å™¨çœ‹èµ·æ¥å°±çœŸçš„åƒæ˜¯ç‹¬ç«‹çš„æ“ä½œç³»ç»Ÿäº†ã€‚

> è¯´æ˜ï¼š
>
> â€œçœŸæ­£å®ç°â€œbuild once, run everywhereâ€â€ã€‚è¿™å¥è¯æ˜¯é”™è¯¯çš„ï¼Œå®é™…ä¸Šç¨‹åºå‘˜ä¾ç„¶æœ‰æ¼”æˆçš„ç©ºé—´ã€‚å› ä¸ºå®¹å™¨åªæ‰“åŒ…äº†ç”¨æˆ·ç©ºé—´çš„ç³»ç»Ÿè°ƒç”¨ï¼Œæ‰§è¡Œç³»ç»Ÿè°ƒç”¨çš„åœ°æ–¹ä¾ç„¶æ˜¯å®¿ä¸»çš„ kernelï¼Œæ‰€ä»¥å½“ä½  docker run centos:6 bash æ‰§è¡Œè¿™å¥è¯çš„æ—¶å€™ï¼Œåœ¨æ–°çš„å†…æ ¸ä¸Šå¯èƒ½ä¼šå‘ç”Ÿæ®µé”™è¯¯ï¼Œè€Œè€çš„å®¿ä¸»æœºå´ä¸ä¼šã€‚**çœŸæ­£è¦åšåˆ° BOREï¼Œè¿˜æ˜¯å¿…ä½¿ç”¨åŒæ ·çš„å†…æ ¸**ï¼Œé‚£æ ·çš„è¯ï¼Œå’Œä½¿ç”¨è™šæ‹Ÿæœºå°±æ²¡å·®åˆ«äº†ã€‚æ€»ä¹‹ä¸å¯èƒ½åšåˆ°å¼€å‘ï¼Œæµ‹è¯•ï¼Œè¿ç»´åªè¦ç”¨åŒä¸€ä¸ªé•œåƒå°±èƒ½è¡¨ç°å®Œå…¨ä¸€è‡´ï¼Œåªè¦æä¾›ç³»ç»Ÿè°ƒç”¨çš„å†…æ ¸ç‰ˆæœ¬ä¸åŒï¼Œå—¯ï¼Œè¡Œä¸ºå°±ç»å¯¹ä¸èƒ½ä¿è¯ä¸€è‡´ã€‚

# **Docker å¿«é€Ÿå…¥é—¨**

> [**Docker å¿«é€Ÿå…¥é—¨**](https://docker.easydoc.net/doc/81170005/cCewZWoN/lTKfePfP)
>
> [Docker â€” ä»å…¥é—¨åˆ°å®è·µ](https://yeasy.gitbook.io/docker_practice)
> [Docker â€” ä»å…¥é—¨åˆ°å®è·µ](http://docker.baoshu.red/introduction/what.html) ---- è·Ÿä¸Šé¢ä¸ä¸€æ ·

Docker æ˜¯ä¸€ä¸ªåº”ç”¨æ‰“åŒ…ã€åˆ†å‘ã€éƒ¨ç½²çš„å·¥å…·
ä½ ä¹Ÿå¯ä»¥æŠŠå®ƒç†è§£ä¸ºä¸€ä¸ªè½»é‡çš„è™šæ‹Ÿæœºï¼Œå®ƒåªè™šæ‹Ÿä½ è½¯ä»¶éœ€è¦çš„è¿è¡Œç¯å¢ƒï¼Œå¤šä½™çš„ä¸€ç‚¹éƒ½ä¸è¦ï¼Œ
è€Œæ™®é€šè™šæ‹Ÿæœºåˆ™æ˜¯ä¸€ä¸ªå®Œæ•´è€Œåºå¤§çš„ç³»ç»Ÿï¼ŒåŒ…å«å„ç§ä¸ç®¡ä½ è¦ä¸è¦çš„è½¯ä»¶ã€‚

### æ‰“åŒ…ã€åˆ†å‘ã€éƒ¨ç½²

**æ‰“åŒ…**ï¼šå°±æ˜¯æŠŠä½ è½¯ä»¶è¿è¡Œæ‰€éœ€çš„**ä¾èµ–**ã€**ç¬¬ä¸‰æ–¹åº“**ã€**è½¯ä»¶**æ‰“åŒ…åˆ°ä¸€èµ·ï¼Œå˜æˆä¸€ä¸ªå®‰è£…åŒ…
**åˆ†å‘**ï¼šä½ å¯ä»¥æŠŠä½ æ‰“åŒ…å¥½çš„â€œå®‰è£…åŒ…â€ä¸Šä¼ åˆ°ä¸€ä¸ªé•œåƒä»“åº“ï¼Œå…¶ä»–äººå¯ä»¥éå¸¸æ–¹ä¾¿çš„è·å–å’Œå®‰è£…
**éƒ¨ç½²**ï¼šæ‹¿ç€â€œå®‰è£…åŒ…â€å°±å¯ä»¥ä¸€ä¸ªå‘½ä»¤è¿è¡Œèµ·æ¥ä½ çš„åº”ç”¨ï¼Œè‡ªåŠ¨æ¨¡æ‹Ÿå‡ºä¸€æ‘¸ä¸€æ ·çš„è¿è¡Œç¯å¢ƒï¼Œä¸ç®¡æ˜¯åœ¨ Windows/Mac/Linuxã€‚

### Docker é€šå¸¸ç”¨æ¥åšä»€ä¹ˆ

- åº”ç”¨åˆ†å‘ã€éƒ¨ç½²ï¼Œæ–¹ä¾¿ä¼ æ’­ç»™ä»–äººå®‰è£…ã€‚ç‰¹åˆ«æ˜¯å¼€æºè½¯ä»¶å’Œæä¾›ç§æœ‰éƒ¨ç½²çš„åº”ç”¨
- å¿«é€Ÿå®‰è£…æµ‹è¯•/å­¦ä¹ è½¯ä»¶ï¼Œç”¨å®Œå°±ä¸¢ï¼ˆç±»ä¼¼å°ç¨‹åºï¼‰ï¼Œä¸æŠŠæ—¶é—´æµªè´¹åœ¨å®‰è£…è½¯ä»¶ä¸Šã€‚ä¾‹å¦‚ Redis / MongoDB / ElasticSearch / ELK
- å¤šä¸ªç‰ˆæœ¬è½¯ä»¶å…±å­˜ï¼Œä¸æ±¡æŸ“ç³»ç»Ÿï¼Œä¾‹å¦‚ Python2ã€Python3ï¼ŒRedis4.0ï¼ŒRedis5.0
- Windows ä¸Šä½“éªŒ/å­¦ä¹ å„ç§ Linux ç³»ç»Ÿ

### **Docker** åŒ…æ‹¬ä¸‰ä¸ªåŸºæœ¬æ¦‚å¿µï¼šé•œåƒã€å®¹å™¨ã€ä»“åº“

- é•œåƒï¼ˆ`Image`ï¼‰ï¼šDocker é•œåƒæ˜¯ä¸€ä¸ªç‰¹æ®Šçš„æ–‡ä»¶ç³»ç»Ÿï¼Œé™¤äº†æä¾›[å®¹å™¨](https://cloud.tencent.com/product/tke?from_column=20065&from=20065)è¿è¡Œæ—¶æ‰€éœ€çš„ç¨‹åºã€åº“ã€èµ„æºã€é…ç½®ç­‰æ–‡ä»¶å¤–ï¼Œè¿˜åŒ…å«äº†ä¸€äº›ä¸ºè¿è¡Œæ—¶å‡†å¤‡çš„ä¸€äº›é…ç½®å‚æ•°ï¼ˆå¦‚åŒ¿åå·ã€ç¯å¢ƒå˜é‡ã€ç”¨æˆ·ç­‰ï¼‰ã€‚é•œåƒä¸åŒ…å«ä»»ä½•åŠ¨æ€æ•°æ®ï¼Œå…¶å†…å®¹åœ¨æ„å»ºä¹‹åä¹Ÿä¸ä¼šè¢«æ”¹å˜ã€‚
- å®¹å™¨ï¼ˆ`Container`ï¼‰ï¼šé•œåƒï¼ˆ`Image`ï¼‰å’Œå®¹å™¨ï¼ˆ`Container`ï¼‰çš„å…³ç³»ï¼Œå°±åƒæ˜¯é¢å‘å¯¹è±¡ç¨‹åºè®¾è®¡ä¸­çš„ `ç±»` å’Œ `å®ä¾‹` ä¸€æ ·ï¼Œé•œåƒæ˜¯é™æ€çš„å®šä¹‰ï¼Œå®¹å™¨æ˜¯é•œåƒè¿è¡Œæ—¶çš„å®ä½“ã€‚å®¹å™¨å¯ä»¥è¢«åˆ›å»ºã€å¯åŠ¨ã€åœæ­¢ã€åˆ é™¤ã€æš‚åœç­‰ã€‚
- ä»“åº“ï¼ˆ`Repository`ï¼‰ï¼šä»“åº“ï¼ˆ`Repository`ï¼‰ç±»ä¼¼ Git çš„è¿œç¨‹ä»“åº“ï¼Œé›†ä¸­å­˜æ”¾é•œåƒæ–‡ä»¶ã€‚

ä¸‰è€…å…³ç³»å¯ä»¥ç”¨ä¸‹å›¾è¡¨ç¤ºï¼š

![Docker](https://ask.qcloudimg.com/http-save/yehe-7565276/joa65awgh4.png)

# éœ‡æƒŠ ğŸ˜± è¶…è¯¦ç»†çš„ Docker å¸¸ç”¨å‘½ä»¤

> [éœ‡æƒŠ ğŸ˜± è¶…è¯¦ç»†çš„ Docker å¸¸ç”¨å‘½ä»¤](https://juejin.cn/post/7245275769219203132)
>
> [ä¸€å¼ è„‘å›¾æ•´ç† Docker å¸¸ç”¨å‘½ä»¤](https://cloud.tencent.com/developer/article/1772136)

![Docker](https://ask.qcloudimg.com/http-save/yehe-7565276/6lldlbgfhn.png)

> tip:
>
> ä¸‹é¢çš„å‘½ä»¤ï¼Œä¹Ÿä¸æ˜¯å¾ˆå…¨ï¼Œéœ€è¦æ›´å…¨å‘½ä»¤çš„æ—¶å€™å†å¦è¡Œå¯»æ‰¾ã€‚

## æœåŠ¡ç›¸å…³å‘½ä»¤

```shell
# å¯åŠ¨ docker æœåŠ¡
systemctl start docker

# åœæ­¢ docker æœåŠ¡
systemctl stop docker

# é‡å¯ docker æœåŠ¡
systemctl restart docker

# æŸ¥çœ‹ docker æœåŠ¡çŠ¶æ€
systemctl status docker

# è®¾ç½®å¼€æœºå¯åŠ¨ docker æœåŠ¡
systemctl enable docker
```

## é•œåƒç›¸å…³å‘½ä»¤

ç›®å‰ Docker å®˜æ–¹ç»´æŠ¤äº†ä¸€ä¸ªå…¬å…±ä»“åº“ [Docker Hub](https://hub.docker.com/)ï¼Œå…¶ä¸­å·²ç»åŒ…æ‹¬äº†æ•°é‡è¶…è¿‡ [2,650,000](https://hub.docker.com/search/?type=image) çš„é•œåƒã€‚å¤§éƒ¨åˆ†éœ€æ±‚éƒ½å¯ä»¥é€šè¿‡åœ¨ Docker Hub ä¸­ç›´æ¥ä¸‹è½½é•œåƒæ¥å®ç°ã€‚

å¯ä»¥åœ¨ https://hub.docker.com å…è´¹æ³¨å†Œä¸€ä¸ª Docker è´¦å·ã€‚

å¯ä»¥é€šè¿‡æ‰§è¡Œ `docker login` å‘½ä»¤äº¤äº’å¼çš„è¾“å…¥ç”¨æˆ·ååŠå¯†ç æ¥å®Œæˆåœ¨å‘½ä»¤è¡Œç•Œé¢ç™»å½• Docker Hubã€‚

å¯ä»¥é€šè¿‡ `docker logout` é€€å‡ºç™»å½•ã€‚

### **æœç´¢é•œåƒ**

```shell
# ä»Docker HubæŸ¥æ‰¾é•œåƒ
docker search [OPTIONS] TERM

--automated :åªåˆ—å‡º automated buildç±»å‹çš„é•œåƒï¼›
--no-trunc :æ˜¾ç¤ºå®Œæ•´çš„é•œåƒæè¿°ï¼›
-f <è¿‡æ»¤æ¡ä»¶>:åˆ—å‡ºæ”¶è—æ•°ä¸å°äºæŒ‡å®šå€¼çš„é•œåƒã€‚

# ä¾‹ï¼š
docker search -f stars=10 java # ä» Docker Hub æŸ¥æ‰¾æ‰€æœ‰é•œåƒååŒ…å« javaï¼Œå¹¶ä¸”æ”¶è—æ•°å¤§äº 10 çš„é•œåƒ
```

### **æ‹‰å–é•œåƒ**

```shell
# ä»é•œåƒä»“åº“ä¸­æ‹‰å–æˆ–è€…æ›´æ–°æŒ‡å®šé•œåƒ
docker pull [OPTIONS] NAME[:TAG|@DIGEST]

-a :æ‹‰å–æ‰€æœ‰ tagged é•œåƒ
--disable-content-trust :å¿½ç•¥é•œåƒçš„æ ¡éªŒ,é»˜è®¤å¼€å¯

# ä¾‹ï¼š
docker pull java # ä»Docker Hubä¸‹è½½javaæœ€æ–°ç‰ˆé•œåƒ
```

> tip:
>
> ```shell
> # æŒ‡å®šç‰ˆæœ¬å·, æ ¼å¼å¦‚ä¸‹
> docker pull é•œåƒå:ç‰ˆæœ¬å·tag
> ```
>
> ä¸åŠ  `tag` çš„æƒ…å†µä¸‹, é»˜è®¤æ‹‰å–çš„å°±æ˜¯ `latest`(æœ€æ–°ç‰ˆæœ¬)ï¼Œå¦‚æœä¸çŸ¥é“ `tag` æœ‰å“ªäº›, å¯ä»¥å» [`Dockerhub`](https://link.juejin.cn/?target=https%3A%2F%2Fhub.docker.com) æŸ¥çœ‹

### **ä½¿ç”¨`Dockerfile`æ„å»ºé•œåƒ**

```shell
# docker build å‘½ä»¤ç”¨äºä½¿ç”¨ Dockerfile åˆ›å»ºé•œåƒ

docker build [OPTIONS] PATH | URL | -

--build-arg=[] :è®¾ç½®é•œåƒåˆ›å»ºæ—¶çš„å˜é‡ï¼›
--cpu-shares :è®¾ç½® cpu ä½¿ç”¨æƒé‡ï¼›
--cpu-period :é™åˆ¶ CPU CFSå‘¨æœŸï¼›
--cpu-quota :é™åˆ¶ CPU CFSé…é¢ï¼›
--cpuset-cpus :æŒ‡å®šä½¿ç”¨çš„CPU idï¼›
--cpuset-mems :æŒ‡å®šä½¿ç”¨çš„å†…å­˜ idï¼›
--disable-content-trust :å¿½ç•¥æ ¡éªŒï¼Œé»˜è®¤å¼€å¯ï¼›
-f :æŒ‡å®šè¦ä½¿ç”¨çš„Dockerfileè·¯å¾„ï¼›
--force-rm :è®¾ç½®é•œåƒè¿‡ç¨‹ä¸­åˆ é™¤ä¸­é—´å®¹å™¨ï¼›
--isolation :ä½¿ç”¨å®¹å™¨éš”ç¦»æŠ€æœ¯ï¼›
--label=[] :è®¾ç½®é•œåƒä½¿ç”¨çš„å…ƒæ•°æ®ï¼›
-m :è®¾ç½®å†…å­˜æœ€å¤§å€¼ï¼›
--memory-swap :è®¾ç½®Swapçš„æœ€å¤§å€¼ä¸ºå†…å­˜+swapï¼Œ"-1"è¡¨ç¤ºä¸é™swapï¼›
--no-cache :åˆ›å»ºé•œåƒçš„è¿‡ç¨‹ä¸ä½¿ç”¨ç¼“å­˜ï¼›
--pull :å°è¯•å»æ›´æ–°é•œåƒçš„æ–°ç‰ˆæœ¬ï¼›
--quiet, -q :å®‰é™æ¨¡å¼ï¼ŒæˆåŠŸååªè¾“å‡ºé•œåƒ IDï¼›
--rm :è®¾ç½®é•œåƒæˆåŠŸååˆ é™¤ä¸­é—´å®¹å™¨ï¼›
--shm-size :è®¾ç½®/dev/shmçš„å¤§å°ï¼Œé»˜è®¤å€¼æ˜¯64Mï¼›
--ulimit :Ulimité…ç½®ã€‚
--squash :å°† Dockerfile ä¸­æ‰€æœ‰çš„æ“ä½œå‹ç¼©ä¸ºä¸€å±‚ã€‚
--tag, -t: é•œåƒçš„åå­—åŠæ ‡ç­¾ï¼Œé€šå¸¸ name:tag æˆ–è€… name æ ¼å¼ï¼›å¯ä»¥åœ¨ä¸€æ¬¡æ„å»ºä¸­ä¸ºä¸€ä¸ªé•œåƒè®¾ç½®å¤šä¸ªæ ‡ç­¾ã€‚
--network: é»˜è®¤ defaultã€‚åœ¨æ„å»ºæœŸé—´è®¾ç½®RUNæŒ‡ä»¤çš„ç½‘ç»œæ¨¡å¼

# ä¾‹ï¼š
# ä½¿ç”¨å½“å‰ç›®å½•çš„ Dockerfile åˆ›å»ºé•œåƒï¼Œæ ‡ç­¾ä¸º runoob/ubuntu:v1ã€‚æ³¨æ„æœ€åè¾¹çš„ç‚¹ `.` è¡¨ç¤ºå½“å‰ç›®å½•, åˆ«ä¸¢äº†
docker build -t runoob/ubuntu:v1 .

# ä½¿ç”¨URL github.com/creack/docker-firefox çš„ Dockerfile åˆ›å»ºé•œåƒã€‚
docker build github.com/creack/docker-firefox

# ä¹Ÿå¯ä»¥é€šè¿‡ -f Dockerfile æ–‡ä»¶çš„ä½ç½®ï¼š
docker build -f /path/to/a/Dockerfile .
```

`Docker` `build` å‘½ä»¤å¯ä»¥ä½¿ç”¨ `Dockerfile` æ¥æ„å»ºé•œåƒã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œ`Dockerfile` æ–‡ä»¶ä½äºæ„å»ºä¸Šä¸‹æ–‡çš„æ ¹ç›®å½•ä¸‹ï¼Œå› æ­¤ `docker build` å‘½ä»¤ä¼šè‡ªåŠ¨è¯»å–ä¸Šä¸‹æ–‡æ ¹è·¯å¾„ä¸‹åä¸º `Dockerfile` çš„æ–‡ä»¶ã€‚å¦‚æœ `Dockerfile` æ–‡ä»¶ä¸åœ¨æ ¹ç›®å½•ä¸‹ï¼Œå¯ä»¥ä½¿ç”¨ `-f` é€‰é¡¹æ¥æŒ‡å®š `Dockerfile` æ–‡ä»¶çš„è·¯å¾„ã€‚ä¾‹å¦‚ï¼Œä»¥ä¸‹å‘½ä»¤å°†ä½¿ç”¨ `/path/to/Dockerfile` æ–‡ä»¶æ„å»ºé•œåƒï¼š

```shell
docker build -f /path/to/Dockerfile -t image_name:tag .
```

å…¶ä¸­ï¼Œ

- `.` è¡¨ç¤ºå½“å‰ç›®å½•.
- `-f` , `--file` Name of the Dockerfile (Default is PATH/Dockerfile)
- `-t` , `--tag` Name and optionally a tag in the name:tag format

[docker build [OPTIONS\]æ–‡æ¡£](https://link.juejin.cn/?target=https%3A%2F%2Fdocs.docker.com%2Fengine%2Freference%2Fcommandline%2Fbuild%2F%23options)

`Dockerfile` ç®€å•åˆ—ä¸¾å‡ ä¸ªæŒ‡ä»¤:

- `FROM` : æŒ‡å®šåŸºç¡€é•œåƒ
- `WORKDIR` : æŒ‡å®šå·¥ä½œç›®å½•
- `COPY` : å°†æ–‡ä»¶æˆ–è€…ç›®å½•ä»æ„å»ºä¸Šä¸‹æ–‡å¤åˆ¶åˆ°å®¹å™¨ä¸­(æ¨è)
- `ADD` : å°†æ–‡ä»¶æˆ–è€…ç›®å½•ä»æ„å»ºä¸Šä¸‹æ–‡å¤åˆ¶åˆ°å®¹å™¨ä¸­,å¹¶ä¸”ä¼šå°†å‹ç¼©æ–‡ä»¶è§£å‹ç¼©,æ”¯æŒ `URL`
- `RUN` : åœ¨å®¹å™¨ä¸­æ‰§è¡Œå‘½ä»¤
- `CMD` : å®¹å™¨å¯åŠ¨æ—¶æ‰§è¡Œçš„å‘½ä»¤
- `EXPOSE` : æŒ‡å®šè¦ç›‘å¬çš„ç«¯å£ä»¥å®ç°ä¸å¤–éƒ¨é€šä¿¡

ä¸¾ä¸ªä¾‹å­:

```Dockerfile
# nodejs server Dockerfile

# FROM node
# or
FROM node:16

WORKDIR /nodeApp

# COPY <å®¿ä¸»æœºç›®å½•æˆ–æ–‡ä»¶è·¯å¾„> <å®¹å™¨å†…ç›®å½•æˆ–æ–‡ä»¶è·¯å¾„>
COPY ./package.json .
# ADD <å®¿ä¸»æœºç›®å½•æˆ–æ–‡ä»¶è·¯å¾„> <å®¹å™¨å†…ç›®å½•æˆ–æ–‡ä»¶è·¯å¾„>
# ADD ./package.json .

# shellæ ¼å¼ï¼šå°±åƒåœ¨å‘½ä»¤è¡Œä¸­è¾“å…¥çš„Shellè„šæœ¬å‘½ä»¤ä¸€æ ·ã€‚
RUN npm install

COPY ./src ./server

EXPOSE 8000

CMD ["node", "./server/index.js"]
```

è¯¦ç»†äº†è§£è¯·æŸ¥çœ‹è¿™ç¯‡[çº¯å¹²è´§ï¼Docker Dockerfile æŒ‡ä»¤å¤§å…¨](https://link.juejin.cn/?target=https%3A%2F%2Fzhuanlan.zhihu.com%2Fp%2F419175543)

### **docker image å‘½ä»¤**

```shell
docker image COMMAND

Commands:
  build       Build an image from a Dockerfile
  history     Show the history of an image
  import      Import the contents from a tarball to create a filesystem image
  inspect     Display detailed information on one or more images
  load        Load an image from a tar archive or STDIN
  ls          List images
  prune       Remove unused images
  pull        Pull an image or a repository from a registry
  push        Push an image or a repository to a registry
  rm          Remove one or more images
  save        Save one or more images to a tar archive (streamed to STDOUT by default)
  tag         Create a tag TARGET_IMAGE that refers to SOURCE_IMAGE
```

### **æŸ¥çœ‹æœ¬åœ°é•œåƒ**

```shell
# åˆ—å‡ºæœ¬åœ°é•œåƒ
docker images [OPTIONS] [REPOSITORY[:TAG]]

-a :åˆ—å‡ºæœ¬åœ°æ‰€æœ‰çš„é•œåƒï¼ˆå«ä¸­é—´æ˜ åƒå±‚ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œè¿‡æ»¤æ‰ä¸­é—´æ˜ åƒå±‚ï¼‰ï¼›
--digests :æ˜¾ç¤ºé•œåƒçš„æ‘˜è¦ä¿¡æ¯ï¼›
-f :æ˜¾ç¤ºæ»¡è¶³æ¡ä»¶çš„é•œåƒï¼›
--format :æŒ‡å®šè¿”å›å€¼çš„æ¨¡æ¿æ–‡ä»¶ï¼›
--no-trunc :æ˜¾ç¤ºå®Œæ•´çš„é•œåƒä¿¡æ¯ï¼›
-q :åªæ˜¾ç¤ºé•œåƒIDã€‚

# ä¾‹ï¼š
docker images # æŸ¥çœ‹æœ¬åœ°é•œåƒåˆ—è¡¨
docker images ubuntu # åˆ—å‡ºæœ¬åœ°é•œåƒä¸­REPOSITORYä¸ºubuntuçš„é•œåƒåˆ—è¡¨
```

### **åˆ é™¤æœ¬åœ°é•œåƒ**

```shell
# åˆ é™¤æœ¬åœ°ä¸€ä¸ªæˆ–å¤šä¸ªé•œåƒ
docker rmi [OPTIONS] IMAGE [IMAGE...]

-f :å¼ºåˆ¶åˆ é™¤ï¼›
--no-prune :ä¸ç§»é™¤è¯¥é•œåƒçš„è¿‡ç¨‹é•œåƒï¼Œé»˜è®¤ç§»é™¤ï¼›

# ä¾‹ï¼š
docker rmi mysql:5.7 # ä½¿ç”¨é•œåƒå:ç‰ˆæœ¬å·tagåˆ é™¤
docker rmi 2be84dd575ee # ä½¿ç”¨é•œåƒIDåˆ é™¤
docker rmi `docker images -f "dangling=true" -q` # åˆ é™¤tagä¸ºnoneçš„é•œåƒ
docker rmi `docker images -q` # å…¨éƒ¨åˆ é™¤æœ¬åœ°é•œåƒ
```

> tip:
> ä¸ºäº†å‡†ç¡®åˆ é™¤ä½ çš„ç›®æ ‡é•œåƒ, å»ºè®®åˆ é™¤æœ‰å¤šä¸ªç‰ˆæœ¬å­˜åœ¨çš„é•œåƒæ—¶, ä½¿ç”¨é•œåƒå:ç‰ˆæœ¬å·, å¦‚æœäºŒè€…é•œåƒ `ID` ä¸åŒä¹Ÿå¯ä»¥ä½¿ç”¨é•œåƒ `ID` è¿›è¡Œåˆ é™¤, é˜²æ­¢è¯¯åˆ 
>
> ä¸èƒ½åˆ é™¤æ­£åœ¨è¿è¡Œçš„å®¹å™¨ä½¿ç”¨ç€çš„é•œåƒ(å‡å¦‚æ˜¯`nginx`é•œåƒ), å¦‚æœç¡®å®æƒ³è¦åˆ é™¤`nginx`, éœ€è¦å…ˆåœæ­¢æ‰€æœ‰ä½¿ç”¨è¿™ä¸ªé•œåƒçš„å®¹å™¨, å¹¶ä¸”å°†è¿™äº›å®¹å™¨åˆ é™¤, æ‰å¯ä»¥åˆ é™¤`nginx`é•œåƒã€‚

### **å¯¼å‡ºé•œåƒ**

```bash
# å°†æŒ‡å®šé•œåƒä¿å­˜æˆ tar å½’æ¡£æ–‡ä»¶
docker save [OPTIONS] IMAGE [IMAGE...]

-o :è¾“å‡ºåˆ°çš„æ–‡ä»¶ã€‚

# ä¾‹ï¼š
docker save -o my_ubuntu_v3.tar runoob/ubuntu:v3
```

### **å¯¼å…¥é•œåƒ**

```shell
# å¯¼å…¥ä½¿ç”¨ docker save å‘½ä»¤å¯¼å‡ºçš„é•œåƒ
docker load [OPTIONS]

--input , -i : æŒ‡å®šå¯¼å…¥çš„æ–‡ä»¶ï¼Œä»£æ›¿ STDINã€‚
--quiet , -q : ç²¾ç®€è¾“å‡ºä¿¡æ¯ã€‚

# ä¾‹ï¼š
docker load -i fedora.tar
```

> tip:
> å¦‚æœç”¨é•œåƒ `ID` å¯¼å‡ºçš„é•œåƒåœ¨å¯¼å…¥ä¹‹åæ˜¯æ²¡æœ‰åå­—å’Œ`tag`çš„, è¿™ç§æƒ…å†µæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ `docker tag` ç»™é•œåƒæ”¹åå­—
>
> ```shell
> docker tag image_id new_image_name:tag
> ```

## å®¹å™¨ç›¸å…³å‘½ä»¤

### **åˆ›å»ºå®¹å™¨**

```shell
# åˆ›å»ºä¸€ä¸ªæ–°çš„å®¹å™¨å¹¶è¿è¡Œä¸€ä¸ªå‘½ä»¤
docker run [OPTIONS] IMAGE [COMMAND] [ARG...]

-a stdin: æŒ‡å®šæ ‡å‡†è¾“å…¥è¾“å‡ºå†…å®¹ç±»å‹ï¼Œå¯é€‰ STDIN/STDOUT/STDERR ä¸‰é¡¹ï¼›
-d: åå°è¿è¡Œå®¹å™¨ï¼Œå¹¶è¿”å›å®¹å™¨IDï¼›
-i: ä»¥äº¤äº’æ¨¡å¼è¿è¡Œå®¹å™¨ï¼Œé€šå¸¸ä¸ -t åŒæ—¶ä½¿ç”¨ï¼›
-P: éšæœºç«¯å£æ˜ å°„ï¼Œå®¹å™¨å†…éƒ¨ç«¯å£éšæœºæ˜ å°„åˆ°ä¸»æœºçš„ç«¯å£
-p: æŒ‡å®šç«¯å£æ˜ å°„ï¼Œæ ¼å¼ä¸ºï¼šä¸»æœº(å®¿ä¸»)ç«¯å£:å®¹å™¨ç«¯å£
-t: ä¸ºå®¹å™¨é‡æ–°åˆ†é…ä¸€ä¸ªä¼ªè¾“å…¥ç»ˆç«¯ï¼Œé€šå¸¸ä¸ -i åŒæ—¶ä½¿ç”¨ï¼›
--name="nginx-lb": ä¸ºå®¹å™¨æŒ‡å®šä¸€ä¸ªåç§°ï¼›
--dns 8.8.8.8: æŒ‡å®šå®¹å™¨ä½¿ç”¨çš„DNSæœåŠ¡å™¨ï¼Œé»˜è®¤å’Œå®¿ä¸»ä¸€è‡´ï¼›
--dns-search example.com: æŒ‡å®šå®¹å™¨DNSæœç´¢åŸŸåï¼Œé»˜è®¤å’Œå®¿ä¸»ä¸€è‡´ï¼›
-h "mars": æŒ‡å®šå®¹å™¨çš„hostnameï¼›
-e username="ritchie": è®¾ç½®ç¯å¢ƒå˜é‡ï¼›
--env-file=[]: ä»æŒ‡å®šæ–‡ä»¶è¯»å…¥ç¯å¢ƒå˜é‡ï¼›
--cpuset="0-2" or --cpuset="0,1,2": ç»‘å®šå®¹å™¨åˆ°æŒ‡å®šCPUè¿è¡Œï¼›
-m :è®¾ç½®å®¹å™¨ä½¿ç”¨å†…å­˜æœ€å¤§å€¼ï¼›
--net="bridge": æŒ‡å®šå®¹å™¨çš„ç½‘ç»œè¿æ¥ç±»å‹ï¼Œæ”¯æŒ bridge/host/none/container: å››ç§ç±»å‹ï¼›
--link=[]: æ·»åŠ é“¾æ¥åˆ°å¦ä¸€ä¸ªå®¹å™¨ï¼›
--expose=[]: å¼€æ”¾ä¸€ä¸ªç«¯å£æˆ–ä¸€ç»„ç«¯å£ï¼›
--volume , -v: ç»‘å®šä¸€ä¸ªå·ï¼Œæ ¼å¼ä¸ºï¼šä¸»æœº(å®¿ä¸»)å·:å®¹å™¨å·
--userï¼šæŒ‡å®šç”¨æˆ·ç™»å½•dockerï¼Œé»˜è®¤çš„ç™»é™†ç”¨æˆ·ä¸º rootï¼Œ--user $(id -u):$(id -g)å¯ä»¥ç”¨å®¿ä¸»æœºä¸­å½“å‰uidå’Œgidçš„ç”¨æˆ·ç™»å½•docker
--privilegedï¼šé»˜è®¤æƒ…å†µä¸‹å®¹å™¨ä¸­çš„rootç”¨æˆ·åªæ˜¯hostä¸»æœºçš„ä¸€ä¸ªæ™®é€šç”¨æˆ·ï¼Œä½†å¦‚æœdocker run --privileged=true å°±çœŸæ­£çš„ç»™è¿™ä¸ªæ™®é€šç”¨æˆ·èµ‹äºˆäº†å’Œhostä¸»æœºrootç”¨æˆ·çš„ç‰¹æƒã€‚
--networkï¼šåœ¨Dockerä¸­ï¼Œé»˜è®¤æƒ…å†µä¸‹å®¹å™¨ä¸å®¹å™¨ã€å®¹å™¨ä¸å¤–éƒ¨å®¿ä¸»æœºçš„ç½‘ç»œæ˜¯éš”ç¦»å¼€æ¥çš„ã€‚å½“ä½ å®‰è£…Dockerçš„æ—¶å€™ï¼Œdockerä¼šåˆ›å»ºä¸€ä¸ªæ¡¥æ¥å™¨docker0ï¼Œé€šè¿‡å®ƒæ‰è®©å®¹å™¨ä¸å®¹å™¨ä¹‹é—´ã€ä¸å®¿ä¸»æœºä¹‹é—´é€šä¿¡ã€‚Dockerå®‰è£…çš„æ—¶å€™é»˜è®¤ä¼šåˆ›å»ºä¸‰ä¸ªä¸åŒçš„ç½‘ç»œã€‚ä½ å¯ä»¥é€šè¿‡docker network lså‘½ä»¤æŸ¥çœ‹è¿™äº›ç½‘ç»œã€‚ç½‘ç»œæ¨¡å¼ä¸ºnoneçš„ï¼Œå³ä¸ä¸ºDocker Containeråˆ›å»ºä»»ä½•çš„ç½‘ç»œç¯å¢ƒã€‚å¦‚æœä½ åœ¨åˆ›å»ºå®¹å™¨çš„æ—¶å€™ä½¿ç”¨--network=hosté€‰é¡¹ï¼Œé‚£ä¹ˆå®¹å™¨ä¼šä½¿ç”¨å®¿ä¸»æœºçš„ç½‘ç»œï¼Œå®¹å™¨ä¸å®¿ä¸»æœºçš„ç½‘ç»œå¹¶æ²¡æœ‰éš”ç¦»ã€‚æ¡¥æ¥ç½‘ç»œ--network=bridgeæ˜¯é»˜è®¤çš„ç½‘ç»œç±»å‹ã€‚

Dcokerå®¹å™¨åœ¨ä½¿ç”¨çš„è¿‡ç¨‹ä¸­ï¼Œé»˜è®¤çš„docker runæ—¶éƒ½æ˜¯ä»¥æ™®é€šæ–¹å¼å¯åŠ¨çš„ï¼Œæœ‰çš„æ—¶å€™æ˜¯éœ€è¦ä½¿ç”¨åœ¨å®¹å™¨ä¸­ä½¿ç”¨iptablesè¿›è¡Œå¯åŠ¨çš„ï¼Œè¿™æ—¶å€™å°±éœ€è¦å¼€å¯æƒé™ï¼Œåªéœ€è¦åœ¨docker runæ—¶å¢åŠ å‚æ•°ã€‚
--cap-add list                   Add Linux capabilities # æ·»åŠ æŸäº›æƒé™
--cap-drop list                  Drop Linux capabilities # å…³é—­æƒé™
--privileged                     Give extended privileges to this container # default false
privilegedï¼Œæƒé™å…¨å¼€ï¼Œä¸åˆ©äºå®¿ä¸»æœºå®‰å…¨ã€‚
cap-add/cap-dropï¼Œç»†ç²’åº¦æƒé™è®¾ç½®ï¼Œéœ€è¦ä»€ä¹ˆå¼€ä»€ä¹ˆ

--restartï¼šå¯ä»¥è®¾ç½®å®¹å™¨çš„é‡å¯ç­–ç•¥ï¼Œä»¥å†³å®šåœ¨å®¹å™¨é€€å‡ºæ—¶Dockerå®ˆæŠ¤è¿›ç¨‹æ˜¯å¦é‡å¯åˆšåˆšé€€å‡ºçš„å®¹å™¨ã€‚
Dockerå®¹å™¨çš„é‡å¯ç­–ç•¥å¦‚ä¸‹ï¼š
- noï¼Œé»˜è®¤ç­–ç•¥ï¼Œåœ¨å®¹å™¨é€€å‡ºæ—¶ä¸é‡å¯å®¹å™¨
- on-failureï¼Œåœ¨å®¹å™¨éæ­£å¸¸é€€å‡ºæ—¶ï¼ˆé€€å‡ºçŠ¶æ€é0ï¼‰ï¼Œæ‰ä¼šé‡å¯å®¹å™¨
- on-failure:3ï¼Œåœ¨å®¹å™¨éæ­£å¸¸é€€å‡ºæ—¶é‡å¯å®¹å™¨ï¼Œæœ€å¤šé‡å¯3æ¬¡
- alwaysï¼Œåœ¨å®¹å™¨é€€å‡ºæ—¶æ€»æ˜¯é‡å¯å®¹å™¨
- unless-stoppedï¼Œåœ¨å®¹å™¨é€€å‡ºæ—¶æ€»æ˜¯é‡å¯å®¹å™¨ï¼Œä½†æ˜¯ä¸è€ƒè™‘åœ¨Dockerå®ˆæŠ¤è¿›ç¨‹å¯åŠ¨æ—¶å°±å·²ç»åœæ­¢äº†çš„å®¹å™¨
åœ¨docker psæŸ¥çœ‹å®¹å™¨æ—¶ï¼Œå¯¹äºä½¿ç”¨äº†--restarté€‰é¡¹çš„å®¹å™¨ï¼Œå…¶å¯èƒ½çš„çŠ¶æ€åªæœ‰Upæˆ–Restartingä¸¤ç§çŠ¶æ€ã€‚


# ä¾‹ï¼š
# ä½¿ç”¨dockeré•œåƒnginx:latestä»¥åå°æ¨¡å¼å¯åŠ¨ä¸€ä¸ªå®¹å™¨,å¹¶å°†å®¹å™¨å‘½åä¸ºmynginxã€‚
docker run --name mynginx -d nginx:latest

# ä½¿ç”¨é•œåƒnginx:latestä»¥åå°æ¨¡å¼å¯åŠ¨ä¸€ä¸ªå®¹å™¨,å¹¶å°†å®¹å™¨çš„80ç«¯å£æ˜ å°„åˆ°ä¸»æœºéšæœºç«¯å£ã€‚
docker run -P -d nginx:latest

# ä½¿ç”¨é•œåƒ nginx:latestï¼Œä»¥åå°æ¨¡å¼å¯åŠ¨ä¸€ä¸ªå®¹å™¨,å°†å®¹å™¨çš„ 80 ç«¯å£æ˜ å°„åˆ°ä¸»æœºçš„ 80 ç«¯å£,ä¸»æœºçš„ç›®å½• /data æ˜ å°„åˆ°å®¹å™¨çš„ /dataã€‚
docker run -p 80:80 -v /data:/data -d nginx:latest

# ç»‘å®šå®¹å™¨çš„ 8080 ç«¯å£ï¼Œå¹¶å°†å…¶æ˜ å°„åˆ°æœ¬åœ°ä¸»æœº 127.0.0.1 çš„ 80 ç«¯å£ä¸Šã€‚
docker run -p 127.0.0.1:80:8080/tcp ubuntu bash

# ä½¿ç”¨é•œåƒnginx:latestä»¥äº¤äº’æ¨¡å¼å¯åŠ¨ä¸€ä¸ªå®¹å™¨,åœ¨å®¹å™¨å†…æ‰§è¡Œ/bin/bashå‘½ä»¤
docker run -it nginx:latest /bin/bash
```

> tip:
> ä½¿ç”¨äº¤äº’æ¨¡å¼è¿è¡Œå®¹å™¨æ—¶, ä¼šç›´æ¥è¿›å…¥å®¹å™¨å†…éƒ¨, é€€å‡ºäº¤äº’æ¨¡å¼å, è¯¥å®¹å™¨è‡ªåŠ¨åœæ­¢è¿è¡Œ
>
> **æ³¨ï¼š** å®¹å™¨æ˜¯å¦ä¼šé•¿ä¹…è¿è¡Œï¼Œæ˜¯å’Œ `docker run` æŒ‡å®šçš„å‘½ä»¤æœ‰å…³ï¼Œå’Œ `-d` å‚æ•°æ— å…³ã€‚----å•¥æ„æ€?

> å½“åˆ©ç”¨ `docker run` æ¥åˆ›å»ºå®¹å™¨æ—¶ï¼ŒDocker åœ¨åå°è¿è¡Œçš„æ ‡å‡†æ“ä½œåŒ…æ‹¬ï¼š
>
> - æ£€æŸ¥æœ¬åœ°æ˜¯å¦å­˜åœ¨æŒ‡å®šçš„é•œåƒï¼Œä¸å­˜åœ¨å°±ä» [registry](https://yeasy.gitbook.io/docker_practice/repository) ä¸‹è½½
> - åˆ©ç”¨é•œåƒåˆ›å»ºå¹¶å¯åŠ¨ä¸€ä¸ªå®¹å™¨
> - åˆ†é…ä¸€ä¸ªæ–‡ä»¶ç³»ç»Ÿï¼Œå¹¶åœ¨åªè¯»çš„é•œåƒå±‚å¤–é¢æŒ‚è½½ä¸€å±‚å¯è¯»å†™å±‚
> - ä»å®¿ä¸»ä¸»æœºé…ç½®çš„ç½‘æ¡¥æ¥å£ä¸­æ¡¥æ¥ä¸€ä¸ªè™šæ‹Ÿæ¥å£åˆ°å®¹å™¨ä¸­å»
> - ä»åœ°å€æ± é…ç½®ä¸€ä¸ª ip åœ°å€ç»™å®¹å™¨
> - æ‰§è¡Œç”¨æˆ·æŒ‡å®šçš„åº”ç”¨ç¨‹åº
> - æ‰§è¡Œå®Œæ¯•åå®¹å™¨è¢«ç»ˆæ­¢

> [Docker run å‘½ä»¤å‚æ•°åŠä½¿ç”¨](https://www.jianshu.com/p/ea4a00c6c21c)
>
> [Docker Network å…¥é—¨ç”¨æ³•](https://loocode.com/post/docker-network-ru-men-yong-fa)
>
> [docker å®¹å™¨çš„æƒé™è®¾ç½®](https://blog.csdn.net/myli92/article/details/127479212)
>
> [Docker å®¹å™¨çš„é‡å¯ç­–ç•¥åŠ docker run çš„--restart é€‰é¡¹è¯¦è§£](https://blog.csdn.net/taiyangdao/article/details/73076019)
>
> [Docker Volume - ç›®å½•æŒ‚è½½ä»¥åŠæ–‡ä»¶å…±äº«](https://kebingzao.com/2019/02/25/docker-volume/)

```shell
# `host` æ¨¡å¼ `-p` é€‰é¡¹ä¸éœ€è¦ï¼Œå› ä¸º `host` æ¨¡å¼ä¸‹å®¹å™¨ç›´æ¥ä½¿ç”¨å®¿ä¸»æœºçš„ç½‘ç»œæ ˆï¼Œç«¯å£æ˜¯å…±äº«çš„ã€‚
docker run -d \
    -it \
    --privileged \
    -h <hostname> \
    --restart always \
    --network host \
    --name ascendc_c00619335 \
    -v /data/c00619335:/data \
    IMAGE \
    /bin/bash

# `bridge` æ¨¡å¼å¯ä»¥ä½¿ç”¨ `-p` é€‰é¡¹æŒ‡å®šç«¯å£
docker run -d \
    -it \
    --privileged \
    -h <hostname> \
    --restart always \
    --network bridge \
    -p <port_h:port_c> \
    --name ascendc_c00619335 \
    -v /data/c00619335:/data \
    IMAGE \
    /bin/bash

docker exec -it ascendc_c00619335 bash
```

### **åˆ é™¤å®¹å™¨**

docker rm å‘½ä»¤ç”¨äºåˆ é™¤ä¸€ä¸ªæˆ–å¤šä¸ªå·²ç»åœæ­¢çš„å®¹å™¨ã€‚
docker rm å‘½ä»¤ä¸ä¼šåˆ é™¤æ­£åœ¨è¿è¡Œçš„å®¹å™¨ï¼Œå¦‚æœä½ éœ€è¦å…ˆåœæ­¢å®¹å™¨ï¼Œå¯ä»¥ä½¿ç”¨ docker stop å‘½ä»¤ã€‚

```shell
# docker start : åˆ é™¤ä¸€ä¸ªæˆ–å¤šä¸ªå·²ç»åœæ­¢çš„å®¹å™¨

docker rm [OPTIONS] CONTAINER [CONTAINER...]

OPTIONSè¯´æ˜ï¼š
-f, --force: å¼ºåˆ¶åˆ é™¤æ­£åœ¨è¿è¡Œçš„å®¹å™¨ï¼ˆä½¿ç”¨ SIGKILL ä¿¡å·ï¼‰ã€‚
-l, --link: åˆ é™¤æŒ‡å®šçš„è¿æ¥ï¼Œè€Œä¸æ˜¯å®¹å™¨æœ¬èº«ã€‚
-v, --volumes: åˆ é™¤å®¹å™¨æŒ‚è½½çš„å·ã€‚

# ç¤ºä¾‹
docker rm my_container # ç”¨å®¹å™¨ååˆ é™¤
docker rm container_id # ç”¨å®¹å™¨IDåˆ é™¤
docker rm `docker ps -aq` # åˆ é™¤å¤šä¸ªæœªè¿è¡Œçš„å®¹å™¨, è¿è¡Œä¸­çš„æ— æ³•åˆ é™¤
```

### **æ›´æ–°å®¹å™¨é…ç½®**

```shell
# æ›´æ–°å®¹å™¨ï¼ŒåŠ¨æ€æ›´æ–°å®¹å™¨çš„èµ„æºé™åˆ¶ã€é‡å¯ç­–ç•¥ç­‰é…ç½®
docker update [OPTIONS] CONTAINER [CONTAINER...]

--blkio-weight		å— IOï¼ˆç›¸å¯¹æƒé‡ï¼‰ï¼Œä»‹äº 10 åˆ° 1000 ä¹‹é—´ï¼Œæˆ– 0 ç¦ç”¨ï¼ˆé»˜è®¤ 0ï¼‰
--cpu-period		é™åˆ¶CPU CFSï¼ˆå®Œå…¨å…¬å¹³è°ƒåº¦ç¨‹åºï¼‰å‘¨æœŸ
--cpu-quota		é™åˆ¶CPU CFSï¼ˆå®Œå…¨å…¬å¹³è°ƒåº¦ç¨‹åºï¼‰é…é¢
--cpu-rt-period		é™åˆ¶CPUå®æ—¶å‘¨æœŸï¼ˆä»¥å¾®ç§’ä¸ºå•ä½ï¼‰
--cpu-rt-runtime		å°†CPUå®æ—¶è¿è¡Œæ—¶é—´é™åˆ¶åœ¨å¾®ç§’çº§
--cpu-shares,-c		CPU ä»½é¢ï¼ˆç›¸å¯¹æƒé‡ï¼‰
--cpus		CPUæ•°é‡
--cpuset-cpus		å…è®¸æ‰§è¡Œçš„ CPU (0-3, 0,1)
--cpuset-mems		å…è®¸æ‰§è¡Œçš„ MEM (0-3, 0,1)
--memory,-m		å†…å­˜é™åˆ¶
--memory-reservation		å†…å­˜è½¯é™åˆ¶
--memory-swap		äº¤æ¢é™åˆ¶ç­‰äºå†…å­˜åŠ äº¤æ¢ï¼š-1 å¯ç”¨æ— é™åˆ¶äº¤æ¢
--pids-limit		API 1.40+ è°ƒæ•´å®¹å™¨ pid é™åˆ¶ï¼ˆè®¾ç½® -1 è¡¨ç¤ºæ— é™åˆ¶ï¼‰
--restart		å®¹å™¨é€€å‡ºæ—¶åº”ç”¨çš„é‡æ–°å¯åŠ¨ç­–ç•¥

# ä¾‹
# æ›´æ–°å®¹å™¨é‡å¯ç­–ç•¥
docker update --restart=on-failure:3 <container_name/id>
```

> [docker update å‘½ä»¤\_docker update -p-CSDN åšå®¢](https://blog.csdn.net/agonie201218/article/details/132420832)

### **æŸ¥çœ‹å®¹å™¨åˆ—è¡¨**

```shell
# åˆ—å‡ºå®¹å™¨
docker ps [OPTIONS]

-a :æ˜¾ç¤ºæ‰€æœ‰çš„å®¹å™¨ï¼ŒåŒ…æ‹¬æœªè¿è¡Œçš„ã€‚
-f :æ ¹æ®æ¡ä»¶è¿‡æ»¤æ˜¾ç¤ºçš„å†…å®¹ã€‚
--format :æŒ‡å®šè¿”å›å€¼çš„æ¨¡æ¿æ–‡ä»¶ã€‚
-l :æ˜¾ç¤ºæœ€è¿‘åˆ›å»ºçš„å®¹å™¨ã€‚
-n :åˆ—å‡ºæœ€è¿‘åˆ›å»ºçš„nä¸ªå®¹å™¨ã€‚
--no-trunc :ä¸æˆªæ–­è¾“å‡ºã€‚
-q :é™é»˜æ¨¡å¼ï¼Œåªæ˜¾ç¤ºå®¹å™¨ç¼–å·ã€‚
-s :æ˜¾ç¤ºæ€»çš„æ–‡ä»¶å¤§å°

# ä¾‹ï¼š
docker ps # æŸ¥çœ‹æ­£åœ¨è¿è¡Œçš„å®¹å™¨åˆ—è¡¨
docker ps -l # æŸ¥çœ‹æœ€è¿‘ä¸€æ¬¡åˆ›å»ºçš„å®¹å™¨
docker ps -a # æŸ¥çœ‹å…¨éƒ¨å®¹å™¨(åŒ…æ‹¬å·²ç»åœæ­¢çš„å®¹å™¨)
```

> tip:
>
> STATUS: å®¹å™¨çŠ¶æ€ã€‚ çŠ¶æ€æœ‰ 7 ç§ï¼š
>
> createdï¼ˆå·²åˆ›å»ºï¼‰
>
> restartingï¼ˆé‡å¯ä¸­ï¼‰
>
> runningï¼ˆè¿è¡Œä¸­ï¼‰
>
> removingï¼ˆè¿ç§»ä¸­ï¼‰
>
> pausedï¼ˆæš‚åœï¼‰
>
> exitedï¼ˆåœæ­¢ï¼‰
>
> deadï¼ˆæ­»äº¡ï¼‰
>
> è¿™äº›çŠ¶æ€ä¸­ï¼Œæœ€é‡è¦å’Œå¸¸è§çš„æ˜¯é™¤äº† restartingï¼ˆé‡å¯ä¸­ï¼‰å’Œ removingï¼ˆè¿ç§»ä¸­ï¼‰ä¹‹å¤–çš„äº”ä¸ªçŠ¶æ€ï¼Œä¸‹é¢åŸºæœ¬ä¸Šç½‘ç»œä¸Šå¤§éƒ¨åˆ†çš„å®¹å™¨ç”Ÿå‘½å‘¨æœŸå›¾éƒ½åªåŒ…å«äº”ä¸ªçŠ¶æ€ï¼šcreatedï¼ˆå·²åˆ›å»ºï¼‰ï¼Œrunningï¼ˆè¿è¡Œä¸­ï¼‰ï¼Œpausedï¼ˆæš‚åœï¼‰ï¼Œexitedï¼ˆåœæ­¢ï¼‰ï¼Œdeadï¼ˆæ­»äº¡ï¼‰ã€‚

### **å¯åŠ¨/åœæ­¢/é‡å¯è¿è¡Œçš„å®¹å™¨**

```shell
# docker start :å¯åŠ¨ä¸€ä¸ªæˆ–å¤šä¸ªå·²ç»è¢«åœæ­¢çš„å®¹å™¨
# docker stop :åœæ­¢ä¸€ä¸ªè¿è¡Œä¸­çš„å®¹å™¨
# docker restart :é‡å¯å®¹å™¨

docker start [OPTIONS] CONTAINER [CONTAINER...]
docker stop [OPTIONS] CONTAINER [CONTAINER...]
docker restart [OPTIONS] CONTAINER [CONTAINER...]

# ä¾‹ï¼š
docker start my_container # ç”¨å®¹å™¨åå¯åŠ¨
docker start container_id # ç”¨å®¹å™¨IDå¯åŠ¨
docker start `docker ps -aq` # ç”¨å®¹å™¨IDå¯åŠ¨å¤šä¸ªå·²åœæ­¢çš„å®¹å™¨

docker stop my_container # ç”¨å®¹å™¨ååœæ­¢
docker stop container_id # ç”¨å®¹å™¨IDåœæ­¢
docker stop `docker ps -q` # ä½¿ç”¨å®¹å™¨IDåœæ­¢å¤šä¸ªæ­£åœ¨è¿è¡Œçš„å®¹å™¨

docker rm my_container # ç”¨å®¹å™¨ååˆ é™¤
docker rm container_id # ç”¨å®¹å™¨IDåˆ é™¤
docker rm `docker ps -aq` # åˆ é™¤å¤šä¸ªæœªè¿è¡Œçš„å®¹å™¨, è¿è¡Œä¸­çš„æ— æ³•åˆ é™¤
```

### **è¿›å…¥å®¹å™¨æ‰§è¡Œå‘½ä»¤**(æ­£åœ¨è¿è¡Œçš„å®¹å™¨æ‰å¯ä»¥è¿›å…¥)

```shell
# åœ¨è¿è¡Œçš„å®¹å™¨ä¸­æ‰§è¡Œå‘½ä»¤
docker exec [OPTIONS] CONTAINER COMMAND [ARG...]

-d :åˆ†ç¦»æ¨¡å¼: åœ¨åå°è¿è¡Œ
-i :å³ä½¿æ²¡æœ‰é™„åŠ ä¹Ÿä¿æŒSTDIN æ‰“å¼€
-t :åˆ†é…ä¸€ä¸ªä¼ªç»ˆç«¯

# ä¾‹ï¼š
# åœ¨å®¹å™¨ mynginx ä¸­ä»¥äº¤äº’æ¨¡å¼æ‰§è¡Œå®¹å™¨å†… /root/runoob.sh è„šæœ¬
docker exec -it mynginx /bin/sh /root/runoob.sh

# åœ¨å®¹å™¨ my_container ä¸­å¼€å¯ä¸€ä¸ªäº¤äº’æ¨¡å¼çš„ç»ˆç«¯
docker exec -it my_container /bin/bash # ä½¿ç”¨å®¹å™¨å
docker exec -it container_id /bin/bash # ä½¿ç”¨å®¹å™¨ID

# ç™»å½• docker æ—¶åˆ‡æ¢è·¯å¾„
docker exec -it <container_name_or_id> bash -c "cd /path/to/directory && exec bash"
```

### **é€€å‡ºå®¹å™¨**

```shell
# é€€å‡ºcontainer
exit
# æˆ–è€…æŒ‰é”®ï¼š
<Ctrl + C>
```

### **æŸ¥çœ‹å®¹å™¨ä¿¡æ¯**

```bash
# è·å–å®¹å™¨/é•œåƒçš„å…ƒæ•°æ®
docker inspect [OPTIONS] NAME|ID [NAME|ID...]

-f :æŒ‡å®šè¿”å›å€¼çš„æ¨¡æ¿æ–‡ä»¶ã€‚
-s :æ˜¾ç¤ºæ€»çš„æ–‡ä»¶å¤§å°ã€‚
--type :ä¸ºæŒ‡å®šç±»å‹è¿”å›JSON

# ä¾‹ï¼š
docker inspect my_container:version_tag # å®¹å™¨å
docker inspect container_id # å®¹å™¨ID
```

å†…å®¹å¾ˆå¤š

### **å®¹å™¨ä¸å®¿ä¸»æœºä¹‹é—´çš„æ•°æ®æ‹·è´**

```shell
# ç”¨äºå®¹å™¨ä¸ä¸»æœºä¹‹é—´çš„æ•°æ®æ‹·è´ã€‚
docker cp [OPTIONS] CONTAINER:SRC_PATH DEST_PATH|-
docker cp [OPTIONS] SRC_PATH|- CONTAINER:DEST_PATH

-L :ä¿æŒæºç›®æ ‡ä¸­çš„é“¾æ¥

# ä¾‹ï¼š
# 1ã€å°†å®¹å™¨ä¸­ç›®å½•æˆ–æ–‡ä»¶æ‹·è´åˆ°å®¿ä¸»æœº
# å°†å®¹å™¨ä¸­ /app/html ç›®å½•æ‹·è´åˆ°å®¿ä¸»æœº /mnt/ ç›®å½•ä¸­
docker cp container_id:/app/html /mnt/

# 2ã€å°†å®¿ä¸»æœºç›®å½•æˆ–æ–‡ä»¶æ‹·è´åˆ°å®¹å™¨ä¸­
# å°†å®¿ä¸»æœº /mnt/dist ç›®å½•æ‹·è´åˆ°å®¹å™¨çš„ /app ç›®å½•ä¸­
docker cp /mnt/dist container_id:/app/

# 3ã€å°†å®¿ä¸»æœº/mnt/distç›®å½•æ‹·è´åˆ°å®¹å™¨ä¸­, å¹¶é‡å‘½åä¸ºhtml
# å°†å®¿ä¸»æœº /mnt/dist ç›®å½•æ‹·è´åˆ°å®¹å™¨çš„ /app/ ä¸­é‡å‘½åä¸º html
docker cp /mnt/dist container_id:/app/html
# å°†å®¿ä¸»æœº /mnt/dist/index1.html æ–‡ä»¶æ‹·è´åˆ°å®¹å™¨çš„ /app/html/ ä¸­é‡å‘½åä¸º index.html
docker cp /mnt/dist/index1.html container_id:/app/html/index.html
```

### ç½‘ç»œæ¨¡å¼æ›´æ”¹

è¦å°† Docker å®¹å™¨çš„ç½‘ç»œæ¨¡å¼ä» `bridge` æ¨¡å¼æ”¹ä¸º `host` æ¨¡å¼ï¼Œä½ ä¸èƒ½ç›´æ¥ä¿®æ”¹æ­£åœ¨è¿è¡Œå®¹å™¨çš„ç½‘ç»œæ¨¡å¼ã€‚ä½ éœ€è¦åœæ­¢å¹¶åˆ é™¤å½“å‰å®¹å™¨ï¼Œç„¶åä½¿ç”¨ `--network host` é‡æ–°å¯åŠ¨å®ƒã€‚ä»¥ä¸‹æ˜¯å…·ä½“çš„æ­¥éª¤ï¼š

1. **æŸ¥çœ‹æ­£åœ¨è¿è¡Œçš„å®¹å™¨**

   é¦–å…ˆï¼Œç¡®è®¤å½“å‰å®¹å™¨çš„åç§°æˆ– IDã€‚å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æŸ¥çœ‹æ­£åœ¨è¿è¡Œçš„å®¹å™¨ï¼š

   ```shell
   docker ps
   ```

   è®°ä¸‹éœ€è¦ä¿®æ”¹ç½‘ç»œæ¨¡å¼çš„å®¹å™¨çš„åç§°æˆ– IDã€‚

2. **åœæ­¢å¹¶åˆ é™¤å®¹å™¨**

   è¦ä¿®æ”¹ç½‘ç»œæ¨¡å¼ï¼Œé¦–å…ˆéœ€è¦åœæ­¢å¹¶åˆ é™¤å®¹å™¨ã€‚ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤åœæ­¢å®¹å™¨ï¼š

   ```shell
   # åœæ­¢å®¹å™¨ï¼š
   docker stop <container_name_or_id>

   # åˆ é™¤å®¹å™¨ï¼š
   docker rm <container_name_or_id>
   ```

3. **ä½¿ç”¨ `host` ç½‘ç»œæ¨¡å¼é‡æ–°è¿è¡Œå®¹å™¨**

   ç°åœ¨ä½ å¯ä»¥ä½¿ç”¨ `--network host` é€‰é¡¹é‡æ–°å¯åŠ¨å®¹å™¨ã€‚

   å¦‚æœä½ ä¹‹å‰ä½¿ç”¨äº† `docker run` åˆ›å»ºå®¹å™¨ï¼Œå¯ä»¥ç±»ä¼¼åœ°è¿è¡Œ `docker run`ï¼Œåªæ˜¯è¿™æ¬¡ä½¿ç”¨ `--network host` é€‰é¡¹ã€‚

   ```shell
   # å‡è®¾åŸå§‹å‘½ä»¤æ˜¯è¿™æ ·ï¼š
   docker run -d -p 80:80 --name my_container <image_name>

   # ä¿®æ”¹ä¸ºä½¿ç”¨ `host` ç½‘ç»œæ¨¡å¼çš„å‘½ä»¤ï¼š
   docker run -d --network host --name my_container <image_name>
   ```

   åœ¨è¿™ä¸ªå‘½ä»¤ä¸­ï¼Œ`-p` é€‰é¡¹å·²ä¸å†éœ€è¦ï¼Œå› ä¸º `host` æ¨¡å¼ä¸‹å®¹å™¨ç›´æ¥ä½¿ç”¨å®¿ä¸»æœºçš„ç½‘ç»œæ ˆï¼Œç«¯å£æ˜¯å…±äº«çš„ã€‚

4. **éªŒè¯ç½‘ç»œæ¨¡å¼**

   å®¹å™¨å¯åŠ¨åï¼Œä½ å¯ä»¥ä½¿ç”¨ `docker inspect` éªŒè¯å®¹å™¨çš„ç½‘ç»œæ¨¡å¼ï¼š

   ```shell
   docker inspect <container_name_or_id> | grep -i "networkmode"
   ```

   è¿™åº”è¯¥æ˜¾ç¤º `host` ä½œä¸ºç½‘ç»œæ¨¡å¼ã€‚

## é•œåƒç›¸å…³å‘½ä»¤è¡¥å……

`docker commit` çš„è¯­æ³•æ ¼å¼ä¸ºï¼š

```shell
docker commit [é€‰é¡¹] <å®¹å™¨IDæˆ–å®¹å™¨å> [<ä»“åº“å>[:<æ ‡ç­¾>]]

æˆ‘ä»¬å¯ä»¥ç”¨ä¸‹é¢çš„å‘½ä»¤å°†å®¹å™¨ä¿å­˜ä¸ºé•œåƒï¼š
```

è¦çŸ¥é“ï¼Œå½“æˆ‘ä»¬è¿è¡Œä¸€ä¸ªå®¹å™¨çš„æ—¶å€™ï¼ˆå¦‚æœä¸ä½¿ç”¨å·çš„è¯ï¼‰ï¼Œæˆ‘ä»¬åšçš„ä»»ä½•æ–‡ä»¶ä¿®æ”¹éƒ½ä¼šè¢«è®°å½•äºå®¹å™¨å­˜å‚¨å±‚é‡Œã€‚è€Œ Docker æä¾›äº†ä¸€ä¸ª `docker commit` å‘½ä»¤ï¼Œå¯ä»¥å°†å®¹å™¨çš„å­˜å‚¨å±‚ä¿å­˜ä¸‹æ¥æˆä¸ºé•œåƒã€‚æ¢å¥è¯è¯´ï¼Œå°±æ˜¯åœ¨åŸæœ‰é•œåƒçš„åŸºç¡€ä¸Šï¼Œå†å åŠ ä¸Šå®¹å™¨çš„å­˜å‚¨å±‚ï¼Œå¹¶æ„æˆæ–°çš„é•œåƒã€‚ä»¥åæˆ‘ä»¬è¿è¡Œè¿™ä¸ªæ–°é•œåƒçš„æ—¶å€™ï¼Œå°±ä¼šæ‹¥æœ‰åŸæœ‰å®¹å™¨æœ€åçš„æ–‡ä»¶å˜åŒ–ã€‚

> æ…ç”¨ `docker commit`
>
> ä½¿ç”¨ `docker commit` å‘½ä»¤è™½ç„¶å¯ä»¥æ¯”è¾ƒç›´è§‚çš„å¸®åŠ©ç†è§£é•œåƒåˆ†å±‚å­˜å‚¨çš„æ¦‚å¿µï¼Œä½†æ˜¯å®é™…ç¯å¢ƒä¸­å¹¶ä¸ä¼šè¿™æ ·ä½¿ç”¨ã€‚

`docker container ls -a` å‘½ä»¤æŸ¥çœ‹å®¹å™¨çš„çŠ¶æ€ã€‚

`docker container stop` å‘½ä»¤æ¥ç»ˆæ­¢ä¸€ä¸ªè¿è¡Œä¸­çš„å®¹å™¨ã€‚

`docker container start` å‘½ä»¤æ¥é‡æ–°å¯åŠ¨å¤„äºç»ˆæ­¢çŠ¶æ€çš„å®¹å™¨ã€‚

`docker container restart` å‘½ä»¤ä¼šå°†ä¸€ä¸ªè¿è¡Œæ€çš„å®¹å™¨ç»ˆæ­¢ï¼Œç„¶åå†é‡æ–°å¯åŠ¨å®ƒã€‚

## æ•°æ®ç®¡ç†

åœ¨å®¹å™¨ä¸­ç®¡ç†æ•°æ®ä¸»è¦æœ‰ä¸¤ç§æ–¹å¼ï¼š

- æ•°æ®å·ï¼ˆVolumesï¼‰
- æŒ‚è½½ä¸»æœºç›®å½• (Bind mounts)

![img](https://yeasy.gitbook.io/~gitbook/image?url=https%3A%2F%2F1881212762-files.gitbook.io%2F%7E%2Ffiles%2Fv0%2Fb%2Fgitbook-x-prod.appspot.com%2Fo%2Fspaces%252F-M5xTVjmK7ax94c8ZQcm%252Fuploads%252Fgit-blob-5950036bba1c30c0b1ab52a73a94b59bbdd5f57c%252Ftypes-of-mounts.png%3Falt%3Dmedia&width=768&dpr=4&quality=100&sign=fb819ed99aeae8422fcffe6597d87acda98625f3220b4187d11feb58447ab739)

`æ•°æ®å·` æ˜¯ä¸€ä¸ªå¯ä¾›ä¸€ä¸ªæˆ–å¤šä¸ªå®¹å™¨ä½¿ç”¨çš„ç‰¹æ®Šç›®å½•ï¼Œå®ƒç»•è¿‡ UnionFSï¼Œå¯ä»¥æä¾›å¾ˆå¤šæœ‰ç”¨çš„ç‰¹æ€§ï¼š

- `æ•°æ®å·` å¯ä»¥åœ¨å®¹å™¨ä¹‹é—´å…±äº«å’Œé‡ç”¨
- å¯¹ `æ•°æ®å·` çš„ä¿®æ”¹ä¼šç«‹é©¬ç”Ÿæ•ˆ
- å¯¹ `æ•°æ®å·` çš„æ›´æ–°ï¼Œä¸ä¼šå½±å“é•œåƒ
- `æ•°æ®å·` é»˜è®¤ä¼šä¸€ç›´å­˜åœ¨ï¼Œå³ä½¿å®¹å™¨è¢«åˆ é™¤

> æ³¨æ„ï¼š`æ•°æ®å·` çš„ä½¿ç”¨ï¼Œç±»ä¼¼äº Linux ä¸‹å¯¹ç›®å½•æˆ–æ–‡ä»¶è¿›è¡Œ mountï¼Œé•œåƒä¸­çš„è¢«æŒ‡å®šä¸ºæŒ‚è½½ç‚¹çš„ç›®å½•ä¸­çš„æ–‡ä»¶ä¼šå¤åˆ¶åˆ°æ•°æ®å·ä¸­ï¼ˆä»…æ•°æ®å·ä¸ºç©ºæ—¶ä¼šå¤åˆ¶ï¼‰ã€‚

```shell
docker volume --help

Commands:
  create      åˆ›å»ºä¸€ä¸ªæ•°æ®å·
  inspect     æ‰“å°ä¸€ä¸ªæˆ–å¤šä¸ªæ•°æ®å·çš„è¯¦ç»†ä¿¡æ¯
  ls          åˆ—å‡ºæ‰€æœ‰æ•°æ®å·
  prune       åˆ é™¤æ‰€æœ‰æœªä½¿ç”¨çš„æ•°æ®å·
  rm          åˆ é™¤ä¸€ä¸ªæˆ–å¤šä¸ªæ•°æ®å·

# ä¾‹ï¼š
# åˆ›å»ºä¸€ä¸ªæ•°æ®å·
docker volume create my-vol

# æŸ¥çœ‹æ‰€æœ‰çš„ æ•°æ®å·
docker volume ls

# åœ¨å®¿ä¸»æœºé‡ŒæŸ¥çœ‹æŒ‡å®š æ•°æ®å· çš„ä¿¡æ¯
docker volume inspect my-vol

# åˆ é™¤æ•°æ®å·
docker volume rm my-vol

# æŒ‚è½½æ•°æ®å·çš„å®¹å™¨ï¼š
# åœ¨ç”¨ docker run å‘½ä»¤çš„æ—¶å€™ï¼Œä½¿ç”¨ --mount æ ‡è®°æ¥å°† æ•°æ®å· æŒ‚è½½åˆ°å®¹å™¨é‡Œã€‚
# ä¸‹é¢åˆ›å»ºä¸€ä¸ªåä¸º web çš„å®¹å™¨ï¼Œå¹¶åŠ è½½ä¸€ä¸ª æ•°æ®å· åˆ°å®¹å™¨çš„ /usr/share/nginx/html ç›®å½•
docker run -d -P \
    --name web \
    # -v my-vol:/usr/share/nginx/html \
    --mount source=my-vol,target=/usr/share/nginx/html \
    nginx:alpine

# æŒ‚è½½ä¸€ä¸ªä¸»æœºç›®å½•ä½œä¸ºæ•°æ®å·
# ä½¿ç”¨ --mountï¼ŒåŠ è½½ä¸»æœºçš„ /src/webapp ç›®å½•åˆ°å®¹å™¨çš„ /usr/share/nginx/htmlç›®å½•
docker run -d -P \
    --name web \
    # -v /src/webapp:/usr/share/nginx/html \
    --mount type=bind,source=/src/webapp,target=/usr/share/nginx/html \
    nginx:alpine
```

> tip:
>
> ```shell
> # åœ¨å®¿ä¸»æœºé‡ŒæŸ¥çœ‹æŒ‡å®š æ•°æ®å· çš„ä¿¡æ¯
> docker volume inspect my-vol
>
> [
>     {
>         "Driver": "local",
>         "Labels": {},
>         "Mountpoint": "/var/lib/docker/volumes/my-vol/_data",
>         "Name": "my-vol",
>         "Options": {},
>         "Scope": "local"
>     }
> ]
> ```
>
> æ³¨ï¼šæ¯åˆ›å»ºä¸€ä¸ª volumeï¼Œdocker ä¼šåœ¨ `/var/lib/docker/volumes/` ä¸‹åˆ›å»ºä¸€ä¸ªå­ç›®å½•ï¼Œé»˜è®¤æƒ…å†µä¸‹ç›®å½•åæ˜¯ä¸€ä¸² UUIDã€‚å¦‚æœæŒ‡å®šäº†åç§°ï¼Œåˆ™ç›®å½•åæ˜¯ volume åç§°ï¼ˆä¾‹å¦‚ä¸Šé¢çš„ my-volï¼‰ã€‚volume é‡Œçš„æ•°æ®éƒ½å­˜å‚¨åœ¨è¿™ä¸ªå­ç›®å½•çš„`_data`ç›®å½•ä¸‹ã€‚==**è¿™ä¸ªè·¯å¾„å¯ä»¥ä¿®æ”¹ï¼Œé‡åˆ°è¿‡ä¸åœ¨ /var/lib/docker/volumes/ ä¸‹é¢çš„ã€‚**==
>
> **MountPoint** å®¿ä¸»æœºä¸Šçš„è·¯å¾„ä¸º `/var/lib/docker/volumes/wmy-vol/_data`ï¼Œæ•°æ®å·çš„åç§°ä¸º my-volã€‚

> tip:
>
> ```shell
> # åˆ é™¤æ•°æ®å·
> docker volume rm my-vol
> ```
>
> `æ•°æ®å·` æ˜¯è¢«è®¾è®¡ç”¨æ¥æŒä¹…åŒ–æ•°æ®çš„ï¼Œå®ƒçš„ç”Ÿå‘½å‘¨æœŸç‹¬ç«‹äºå®¹å™¨ï¼ŒDocker ä¸ä¼šåœ¨å®¹å™¨è¢«åˆ é™¤åè‡ªåŠ¨åˆ é™¤ `æ•°æ®å·`ï¼Œå¹¶ä¸”ä¹Ÿä¸å­˜åœ¨åƒåœ¾å›æ”¶è¿™æ ·çš„æœºåˆ¶æ¥å¤„ç†æ²¡æœ‰ä»»ä½•å®¹å™¨å¼•ç”¨çš„ `æ•°æ®å·`ã€‚
>
> å¦‚æœéœ€è¦åœ¨åˆ é™¤å®¹å™¨çš„åŒæ—¶ç§»é™¤æ•°æ®å·ã€‚å¯ä»¥åœ¨åˆ é™¤å®¹å™¨çš„æ—¶å€™ä½¿ç”¨ `docker rm -v` è¿™ä¸ªå‘½ä»¤ã€‚

> tip:
>
> ```shell
> # åœ¨ç”¨ docker run å‘½ä»¤çš„æ—¶å€™ï¼Œä½¿ç”¨ --mount æ ‡è®°æ¥å°† æ•°æ®å· æŒ‚è½½åˆ°å®¹å™¨é‡Œã€‚
> # ä¸‹é¢åˆ›å»ºä¸€ä¸ªåä¸º web çš„å®¹å™¨ï¼Œå¹¶åŠ è½½ä¸€ä¸ª æ•°æ®å· åˆ°å®¹å™¨çš„ /usr/share/nginx/html ç›®å½•
> docker run -d -P \
>     --name web \
>     # -v my-vol:/usr/share/nginx/html \
>     --mount source=my-vol,target=/usr/share/nginx/html \
>     nginx:alpine
>
> # æŒ‚è½½ä¸€ä¸ªä¸»æœºç›®å½•ä½œä¸ºæ•°æ®å·
> # ä½¿ç”¨ --mountï¼ŒåŠ è½½ä¸»æœºçš„ /src/webapp ç›®å½•åˆ°å®¹å™¨çš„ /usr/share/nginx/htmlç›®å½•
> docker run -d -P \
>     --name web \
>     # -v /src/webapp:/usr/share/nginx/html \
>     --mount type=bind,source=/src/webapp,target=/usr/share/nginx/html \
>     nginx:alpine
> ```
>
> æŒ‚è½½æ•°æ®å·ç›¸å…³æ€»ç»“ï¼š
>
> > [Docker åŸºç¡€çŸ¥è¯† - ä½¿ç”¨ç»‘å®šæŒ‚è½½(bind mounts)ç®¡ç†åº”ç”¨ç¨‹åºæ•°æ®](https://ittranslator.cn/backend/docker/2020/07/13/docker-storage-bind-mounts.html)
> >
> > [Docker æ•°æ®ç®¡ç†-volume/bind mount/tmpfs mount](https://blog.zhimma.com/2019/04/10/Docker%E6%95%B0%E6%8D%AE%E7%AE%A1%E7%90%86-volume-bind-mount-tmpfs-mount/)
>
> 1. é€‰æ‹© `-v` æˆ–è€… `--mount` æ ‡è®°
>
>    æœ€åˆï¼Œ`-v` æˆ– `--volume` æ ‡è®°ç”¨äºç‹¬ç«‹å®¹å™¨ï¼Œ`--mount` æ ‡è®°ç”¨äºé›†ç¾¤æœåŠ¡ã€‚ä½†æ˜¯ï¼Œä» Docker 17.06 å¼€å§‹ï¼Œæ‚¨ä¹Ÿå¯ä»¥å°† `--mount` ç”¨äºç‹¬ç«‹å®¹å™¨ã€‚
>
>    é€šå¸¸ï¼Œ`--mount` æ ‡è®°è¡¨è¾¾æ›´åŠ æ˜ç¡®å’Œå†—é•¿ã€‚æœ€å¤§çš„åŒºåˆ«æ˜¯ `-v` è¯­æ³•å°†æ‰€æœ‰é€‰é¡¹ç»„åˆåœ¨ä¸€ä¸ªå­—æ®µä¸­ï¼Œè€Œ `--mount` è¯­æ³•å°†é€‰é¡¹åˆ†ç¦»ã€‚ä¸‹é¢æ˜¯æ¯ä¸ªæ ‡è®°çš„è¯­æ³•æ¯”è¾ƒã€‚
>
>    > æç¤ºï¼šæ–°ç”¨æˆ·æ¨èä½¿ç”¨ `--mount` è¯­æ³•ï¼Œæœ‰ç»éªŒçš„ç”¨æˆ·å¯èƒ½æ›´ç†Ÿæ‚‰ `-v` or `--volume` è¯­æ³•ï¼Œä½†æ˜¯æ›´é¼“åŠ±ä½¿ç”¨ `--mount` è¯­æ³•ï¼Œå› ä¸ºç ”ç©¶è¡¨æ˜å®ƒæ›´æ˜“äºä½¿ç”¨ã€‚
>
>    - `-v` æˆ– `--volume` : ç”±ä¸‰ä¸ªå­—æ®µç»„æˆï¼Œä»¥å†’å·(:)åˆ†éš”ã€‚å¦‚`<å·å>:<å®¹å™¨è·¯å¾„>:<é€‰é¡¹åˆ—è¡¨>`ã€‚å­—æ®µå¿…é¡»æŒ‰ç…§æ­£ç¡®çš„é¡ºåºæ’åˆ—ï¼Œä¸”æ¯ä¸ªå­—æ®µçš„å«ä¹‰ä¸å¤Ÿç›´è§‚æ˜æ˜¾ã€‚
>      - å¯¹äºç»‘å®šæŒ‚è½½ï¼ˆbind mountsï¼‰, ç¬¬ä¸€ä¸ªå­—æ®µæ˜¯ä¸»æœºä¸Šæ–‡ä»¶æˆ–ç›®å½•çš„è·¯å¾„ã€‚
>      - ç¬¬äºŒä¸ªå­—æ®µæ˜¯å®¹å™¨ä¸­æ–‡ä»¶æˆ–ç›®å½•æŒ‚è½½çš„è·¯å¾„ã€‚
>      - ç¬¬ä¸‰ä¸ªå­—æ®µæ˜¯å¯é€‰çš„ï¼Œæ˜¯ä¸€ä¸ªé€—å·åˆ†éš”çš„é€‰é¡¹åˆ—è¡¨ï¼Œæ¯”å¦‚ `ro`ã€`consistent`ã€ `delegated`ã€ `cached`ã€ `z` å’Œ `Z`ã€‚è¿™äº›é€‰é¡¹ä¼šåœ¨æœ¬æ–‡ä¸‹é¢è®¨è®ºã€‚
>    - `--mount` ï¼šç”±å¤šä¸ªé”®-å€¼å¯¹ç»„æˆï¼Œä»¥é€—å·åˆ†éš”ï¼Œæ¯ä¸ªé”®-å€¼å¯¹ç”±ä¸€ä¸ª `<key>=<value>` å…ƒç»„ç»„æˆã€‚`--mount` è¯­æ³•æ¯” `-v` æˆ– `--volume` æ›´å†—é•¿ï¼Œä½†æ˜¯é”®çš„é¡ºåºå¹¶ä¸é‡è¦ï¼Œæ ‡è®°çš„å€¼ä¹Ÿæ›´å®¹æ˜“ç†è§£ã€‚
>      - æŒ‚è½½çš„ç±»å‹ï¼ˆ`type`ï¼‰ï¼Œå¯ä»¥æ˜¯ `bind`ã€`volume` æˆ–è€… `tmpfs`ã€‚æœ¬ä¸»é¢˜è®¨è®ºç»‘å®šæŒ‚è½½ï¼ˆbind mountsï¼‰ï¼Œå› æ­¤ç±»å‹ï¼ˆ`type`ï¼‰å§‹ç»ˆä¸ºç»‘å®šæŒ‚è½½ï¼ˆ`bind`ï¼‰ã€‚
>      - æŒ‚è½½çš„æºï¼ˆ`source`ï¼‰ï¼Œå¯¹äºç»‘å®šæŒ‚è½½ï¼Œè¿™æ˜¯ Docker å®ˆæŠ¤è¿›ç¨‹ä¸»æœºä¸Šçš„æ–‡ä»¶æˆ–ç›®å½•çš„è·¯å¾„ã€‚å¯ä»¥ç”¨ `source` æˆ–è€… `src` æ¥æŒ‡å®šã€‚
>      - ç›®æ ‡ï¼ˆ`destination`ï¼‰ï¼Œå°†å®¹å™¨ä¸­æ–‡ä»¶æˆ–ç›®å½•æŒ‚è½½çš„è·¯å¾„ä½œä¸ºå…¶å€¼ã€‚å¯ä»¥ç”¨ `destination`ã€`dst` æˆ–è€… `target` æ¥æŒ‡å®šã€‚
>      - `readonly` é€‰é¡¹ï¼ˆå¦‚æœå­˜åœ¨ï¼‰ï¼Œåˆ™ä¼šå°†ç»‘å®šæŒ‚è½½ä»¥[åªè¯»å½¢å¼æŒ‚è½½åˆ°å®¹å™¨](https://ittranslator.cn/backend/docker/2020/07/13/docker-storage-bind-mounts.html#use-a-read-only-bind-mount)ä¸­ã€‚
>      - `bind-propagation` é€‰é¡¹ï¼ˆå¦‚æœå­˜åœ¨ï¼‰ï¼Œåˆ™æ›´æ”¹[ç»‘å®šä¼ æ’­](https://ittranslator.cn/backend/docker/2020/07/13/docker-storage-bind-mounts.html#configure-bind-propagation)ã€‚ å¯èƒ½çš„å€¼æ˜¯ `rprivate`ã€ `private`ã€ `rshared`ã€ `shared`ã€ `rslave` æˆ– `slave` ä¹‹ä¸€ã€‚
>      - [`consistency`](https://ittranslator.cn/backend/docker/2020/07/13/docker-storage-bind-mounts.html#configure-mount-consistency-for-macos) é€‰é¡¹ï¼ˆå¦‚æœå­˜åœ¨ï¼‰ï¼Œ å¯èƒ½çš„å€¼æ˜¯ `consistent`ã€ `delegated` æˆ– `cached` ä¹‹ä¸€ã€‚ è¿™ä¸ªè®¾ç½®åªé€‚ç”¨äº Docker Desktop for Macï¼Œåœ¨å…¶ä»–å¹³å°ä¸Šè¢«å¿½ç•¥ã€‚
>      - `--mount` æ ‡è®°ä¸æ”¯æŒç”¨äºä¿®æ”¹ selinux æ ‡ç­¾çš„ `z` æˆ– `Z`é€‰é¡¹ã€‚
>
> 2. `-v` å’Œ `--mount` è¡Œä¸ºä¹‹é—´çš„å·®å¼‚
>
> ç”±äº `-v` å’Œ `-volume` æ ‡è®°é•¿æœŸä»¥æ¥ä¸€ç›´æ˜¯ Docker çš„ä¸€éƒ¨åˆ†ï¼Œå®ƒä»¬çš„è¡Œä¸ºæ— æ³•æ”¹å˜ã€‚è¿™æ„å‘³ç€ `-v` å’Œ `-mount` ä¹‹é—´æœ‰ä¸€ä¸ªä¸åŒçš„è¡Œä¸ºã€‚
>
> å¦‚æœæ‚¨ä½¿ç”¨ `-v` æˆ– `-volume` æ¥ç»‘å®šæŒ‚è½½ Docker ä¸»æœºä¸Šè¿˜ä¸å­˜åœ¨çš„æ–‡ä»¶æˆ–ç›®å½•ï¼Œåˆ™ `-v` å°†ä¸ºæ‚¨åˆ›å»ºå®ƒã€‚å®ƒæ€»æ˜¯ä½œä¸ºç›®å½•åˆ›å»ºçš„ã€‚
>
> å¦‚æœä½¿ç”¨ `--mount` ç»‘å®šæŒ‚è½½ Docker ä¸»æœºä¸Šè¿˜ä¸å­˜åœ¨çš„æ–‡ä»¶æˆ–ç›®å½•ï¼ŒDocker ä¸ä¼šè‡ªåŠ¨ä¸ºæ‚¨åˆ›å»ºå®ƒï¼Œè€Œæ˜¯äº§ç”Ÿä¸€ä¸ªé”™è¯¯ã€‚
>
> 3. Docker æŒ‚è½½æ–¹å¼
>
>    Docker æä¾›äº† 3 ç§æ–¹æ³•å°†æ•°æ®ä» Docker å®¿ä¸»æœºæŒ‚è½½ï¼ˆmountï¼‰åˆ°å®¹å™¨ï¼š`volumes`ï¼Œ`bind mounts`å’Œ`tmpfs mounts`ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œ`volumes`æ€»æ˜¯æœ€å¥½çš„é€‰æ‹©ã€‚
>
>    ä¸ç®¡ä½ é€‰æ‹©å“ªç§æŒ‚è½½æ–¹å¼ï¼Œä»å®¹å™¨ä¸­çœ‹éƒ½æ˜¯ä¸€æ ·çš„ã€‚æ•°æ®åœ¨å®¹å™¨çš„æ–‡ä»¶ç³»ç»Ÿä¸­è¢«å±•ç¤ºä¸ºä¸€ä¸ªç›®å½•æˆ–è€…ä¸€ä¸ªå•ç‹¬çš„æ–‡ä»¶ã€‚
>
>    ä¸€ä¸ªç®€å•åŒºåˆ†`volumes`ï¼Œ`bind mounts`å’Œ`tmpfs mounts`ä¸åŒç‚¹çš„æ–¹æ³•æ˜¯ï¼š**æ€è€ƒæ•°æ®åœ¨å®¿ä¸»æœºä¸Šæ˜¯å¦‚ä½•å­˜åœ¨çš„ã€‚**
>
>    - **Volumes**ç”± Docker ç®¡ç†ï¼Œå­˜å‚¨åœ¨å®¿ä¸»æœºçš„æŸä¸ªåœ°æ–¹ï¼ˆåœ¨ linux ä¸Šæ˜¯`/var/lib/docker/volumes/`ï¼‰ã€‚é Docker åº”ç”¨ç¨‹åºä¸èƒ½æ”¹åŠ¨è¿™ä¸€ä½ç½®çš„æ•°æ®ã€‚Volumes æ˜¯ Docker æœ€å¥½çš„æ•°æ®æŒä¹…åŒ–æ–¹æ³•ã€‚
>    - **Bind mounts**çš„æ•°æ®å¯ä»¥å­˜æ”¾åœ¨å®¿ä¸»æœºçš„ä»»ä½•åœ°æ–¹ã€‚æ•°æ®ç”šè‡³å¯ä»¥æ˜¯é‡è¦çš„ç³»ç»Ÿæ–‡ä»¶æˆ–ç›®å½•ã€‚é Docker åº”ç”¨ç¨‹åºå¯ä»¥æ”¹å˜è¿™äº›æ•°æ®ã€‚
>    - **tmpfs mounts**çš„æ•°æ®åªå­˜å‚¨åœ¨å®¿ä¸»æœºçš„å†…å­˜ä¸­ï¼Œä¸ä¼šå†™å…¥åˆ°å®¿ä¸»æœºçš„æ–‡ä»¶ç³»ç»Ÿã€‚

# docker çŸ¥è¯†ç¢ç‰‡

## debconf: unable to initialize frontend: Dialog

> [debconf: unable to initialize frontend: Dialog é—®é¢˜è§£å†³](https://blog.csdn.net/weixin_44413445/article/details/137875391?spm=1001.2101.3001.6650.3&utm_medium=distribute.pc_relevant.none-task-blog-2%7Edefault%7EYuanLiJiHua%7EPosition-3-137875391-blog-111039589.235%5Ev43%5Epc_blog_bottom_relevance_base3&depth_1-utm_source=distribute.pc_relevant.none-task-blog-2%7Edefault%7EYuanLiJiHua%7EPosition-3-137875391-blog-111039589.235%5Ev43%5Epc_blog_bottom_relevance_base3&utm_relevant_index=4)

æ–‡ç« è®²è¿°äº†åœ¨ä½¿ç”¨ debconf æ—¶é‡åˆ°åˆå§‹åŒ–å‰ç«¯é—®é¢˜ï¼ˆDialog å’Œ Readline ä¸æ”¯æŒï¼‰çš„è§£å†³æ–¹æ¡ˆï¼ŒåŒ…æ‹¬é€šè¿‡å‘½ä»¤è¡Œè®¾ç½®éäº¤äº’å¼æ¨¡å¼å’Œåœ¨ Dockerfile ä¸­ä¿®æ”¹ç¯å¢ƒå˜é‡ DEBIAN_FRONTENDã€‚è¿˜æåˆ°äº†åœ¨ CI/CD æµç¨‹ä¸­çš„åº”ç”¨å®ä¾‹ã€‚

æ³•ä¸€ï¼š

```shell
echo 'debconf debconf/frontend select Noninteractive' | debconf-set-selections
sudo apt-get install -y -q
```

ç”±äºç”¨çš„ cicdï¼Œé€‰æ‹©åœ¨ sh æ–‡ä»¶ä¸­åŠ ä¸Šè¿°å†…å®¹è§£å†³é—®é¢˜

æ³•äºŒï¼š
ä¿®æ”¹ Dockerfileï¼Œæ·»åŠ  DEBIAN_FRONTEND=noninteractive

å‚è€ƒ
https://github.com/moby/moby/issues/27988

## Dockerï¼šå¦‚ä½•å…³é—­ä»¥--restart=always å¯åŠ¨çš„å®¹å™¨

```shell
docker update --restart=no <container-id>
docker stop <container-id>
```

## Error response from daemon: No such image

> [Docker åˆ é™¤é•œåƒå¤±è´¥](https://blog.csdn.net/maple0102/article/details/82690215)
>
> [docker tag Error response from daemon: No such image: lhzx-gateway:latest](https://blog.51cto.com/u_16175504/6945027)

1. åˆ é™¤æ‰€æœ‰é•œåƒã€å®¹å™¨ã€ç½‘ç»œå’Œå·çš„æ–¹æ³•ï¼š`docker system prune -a`
2. å¯èƒ½æ˜¯ç”±äº Docker å®ˆæŠ¤è¿›ç¨‹å‡ºç°äº†é”™è¯¯ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå¯ä»¥å°è¯•é‡å¯ Docker æœåŠ¡ã€‚`sudo systemctl restart docker`
