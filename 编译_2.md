[toc]

# 编译分析命令

## strings 命令

`strings` 命令是 Linux/Unix 系统中用于提取文件中可打印字符序列的实用工具，特别适用于分析**二进制文件、库文件、可执行文件**等。

1. **`strings` 本质：用于从二进制文件中提取“连续的可打印字符序列”。**

   它不理解：ELF、PE、Mach-O、段 / section / symbol。
   它只做一件事：**线性扫描字节流，找连续的可打印字符（ASCII / UTF-8）**
   因此它：✔️ 非常通用、✔️ 对格式不敏感、❌ 不理解语义、❌ 不保证完整性。

2. **`strings` 的工作规则（必须知道）**

   - “可打印字符” 默认包含：

     - ASCII 32–126
     - 空格算
     - 不包含 `\0`

   - “字符串” 默认规则：

     - **连续 ≥ 4 个可打印字符**
     - 碰到不可打印字符就结束

     ```bash
     # 示意：
     51 75 61 6e 74 00
     Q  u  a  n  t  \0

     # 输出：
     Quant
     ```

   - 它是“滑动窗口扫描”

     - 不关心边界
     - 不关心对齐
     - 不关心文件结构

     所以：

     - 一个字符串可能跨 section
     - 也可能是“假阳性”

**一、基本用法**

```bash
strings [选项] <文件名>
```

常用选项：

| 选项               | 说明                                                                 |
| :----------------- | :------------------------------------------------------------------- |
| `-n <长度>`        | 设置最小字符串长度（默认 4）                                         |
| `-t {o,d,x}`       | 显示字符串在文件中的偏移量（8, 10, 16 进制）                         |
| `-a`               | 扫描整个文件，不仅仅是数据段（默认开启）                             |
| `-d`               | 仅扫描数据段                                                         |
| `-e {s,S,b,l,B,L}` | 指定字符编码（s = 7-bit, S = 8-bit, {b,l} = 16-bit, {B,L} = 32-bit） |
| `-f`               | 在每个字符串前显示文件名                                             |
| `-o`               | 相当于 `-t o`（八进制偏移）                                          |
| `--help`           | 显示帮助信息                                                         |

**二、实际应用示例**

1. 基本字符串提取

   ```bash
   strings libexample.so
   ```

   扫描整个文件中长度大于等于 4 的字符串。

2. 设置最小字符串长度

   ```bash
   # 只显示长度至少为10的字符串
   strings -n 10 program.bin

   # 显示短字符串（例如密码、密钥可能较短）
   strings -n 3 file.bin
   ```

3. 显示偏移量（定位字符串位置）

   ```bash
   # 显示十六进制偏移量
   strings -t x malware.exe

   # 显示十进制偏移量
   strings -t d library.a

   # 显示八进制偏移量
   strings -o object.o
   ```

4. 分析多个文件

   ```bash
   # 显示每个字符串所属的文件名
   strings -f *.so *.dll

   # 配合find使用
   find /usr/lib -name "*.so" -exec strings {} \;
   ```

**三、二进制文件分析实战**

1. 查找硬编码的敏感信息（逆向 / 安全分析（经典用途））

   ```bash
   # 查找可能的密码、密钥
   strings -n 8 binary_file | grep -E "(password|key|secret|token|auth)"

   # 查找URL
   strings binary_file | grep -i "http://\|https://"

   # 查看可能的C2服务器地址
   strings malware.bin | grep -E "[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}"

   # 查找可能的域名
   strings malware.bin | grep -E "[a-zA-Z0-9]+\.[a-zA-Z]{2,}"
   ```

2. 分析库文件

   ```bash
   # 查看共享库中的函数名和符号
   strings libfoo.so | grep "^[A-Za-z_]" | head -20

   # 查看是否包含路径 / 源码信息
   strings xxx.so | grep '/home'

   # 排查版本 / 编译器 / 时间戳
   strings xxx.so | grep -i clang

   # 查找常量定义
   strings app.exe | grep -E "[A-Z]{5,}_[A-Z]{5,}"
   ```

3. 逆向工程辅助

   ```bash
   # 结合objdump分析
   strings -t x program | grep "Copyright\|Version"
   objdump -s -j .rodata program | less
   ```

4. 统计最常见的字符串

   ```bash
   # 统计最常见的字符串
   strings binary_file | sort | uniq -c | sort -nr | head -20
   ```

**四、高级技巧**

1. 结合其他工具

   ```bash
   # 使用hexdump和strings结合
   hexdump -C file.bin | head -50
   strings -t x file.bin | head -50

   # 使用radare2更深入分析
   r2 -c "iz" binary_file  # radare2的字符串分析命令
   ```

2. 创建分析脚本

   ```bash
   #!/bin/bash
   # strings_analysis.sh
   FILE=$1

   echo "=== 基本信息 ==="
   file $FILE

   echo -e "\n=== 字符串分析（长度>=8）==="
   strings -n 8 -t x $FILE | head -30

   echo -e "\n=== 可能的URL ==="
   strings $FILE | grep -E "https?://" | head -10

   echo -e "\n=== 可能的IP地址 ==="
   strings $FILE | grep -E "\b([0-9]{1,3}\.){3}[0-9]{1,3}\b" | head -10
   ```

3. 不同平台的可执行文件

   ```bash
   # Windows PE文件
   strings -e l program.exe  # 16位小端序

   # ELF文件（Linux）
   strings -a program.elf

   # Mach-O（macOS）
   strings binary.app/Contents/MacOS/binary
   ```

五、注意事项

1. **假阳性**：`strings` 会提取所有看似字符串的数据，包括随机数据
2. **编码问题**：可能需要尝试不同的编码选项（`-e`）
3. **性能**：大文件可能需要较长时间处理
4. **局限性**：`strings` 只显示可打印字符，对于**加密或混淆的字符串**无效

替代工具：

- **rabin2**（来自 radare2 套件）：更专业的二进制分析工具
- **floss**：FireEye Labs Obfuscated String Solver，用于解混淆字符串
- **binwalk**：固件分析，可提取嵌入的文件和字符串

`strings` 是二进制分析的入门工具，虽然简单，但在初步分析、快速调查和获取上下文信息时非常有用。对于深度分析，建议结合使用更专业的逆向工程工具。
